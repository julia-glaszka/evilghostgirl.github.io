<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" class="h-full" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D,%22class%22:%7B%22ssr%22:%22h-full%22%7D%7D">
  <head>
    <title>Autodydaktycznie. Blog o technologiach webowych i IT | Julia Glaszka</title><meta name="gridsome:hash" content="d07bc2106c9dc1a9637ed368f495606bce2b5587"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="theme-color" content="#261447"><meta data-vue-tag="ssr" name="msapplication-navbutton-color" content="#261447"><meta data-vue-tag="ssr" name="apple-mobile-web-app-status-bar-style" content="#261447"><meta data-vue-tag="ssr" name="viewport" content="width=device-width"><meta data-vue-tag="ssr" data-key="description" name="description" content="Blog o moich samodzielnych zmaganiach z nauką z różnych dziedzin IT. "><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.34768914d4a101067dd64a8f857ab22c.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Work+Sans:700&amp;display=swap"><link rel="preload" href="/assets/css/0.styles.40f6c414.css" as="style"><link rel="preload" href="/assets/js/app.638d8796.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.e461cfa3.js" as="script"><link rel="prefetch" href="/assets/js/9.b470348d.js"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.be318498.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.8bbf9b99.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue~page--src--templates--author-vue.800c557e.js"><link rel="prefetch" href="/assets/js/page--src--templates--author-vue.f18b3135.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.3d4c19d3.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--index-vue~page--src--templates--author-vue~page--src--templates--post-vue~~a0fae544.8b29f019.js"><link rel="stylesheet" href="/assets/css/0.styles.40f6c414.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body class="antialiased font-serif" data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22antialiased%20font-serif%22%7D%7D">
    <div data-server-rendered="true" id="app" class="container-fluid  bg-white"><nav class="navbar"><div class="navbar-brand container has-text-centered has-padding-bottom-10 has-padding-top-15"><a href="/" class="navbar-item has-text-weight-semibold has-text-black-bis	">✨ Julia Glaszka ✨</a></div></nav><header data-v-7271fefd><nav class="section p-b-xs p-t-md" data-v-7271fefd><div class="container"><a href="/" class="button is-outlined is-rounded is-small active">
      ← Powrót
    </a></div></nav><section class="hero" data-v-7271fefd><div class="hero-body" data-v-7271fefd><div class="container has-text-centered" data-v-7271fefd><div class="columns is-centered" data-v-7271fefd><div class="column is-half-desktop" data-v-7271fefd><h5 class="has-text-6 is-uppercase" data-v-7271fefd>
              3 min czytania
            </h5><h1 class="title is-size-2 p-t-md" data-v-7271fefd>
              Konfiguracja ClusterSettings w MongoDB Java Driver
            </h1><h2 class="subtitle p-t-md" data-v-7271fefd><span data-v-7271fefd><a href="/author/Julia/" class="text-gray-700 capitalize border-b border-transparent hover:border-gray-400 transition-colors duration-300" data-v-7271fefd>
                  Julia</a> •
              </span><time datetime="2021-10-07 20:22:24" class="capitalize" data-v-7271fefd>07 October, 2021</time></h2></div></div></div></div></section><div class="section" data-v-7271fefd><div class="container" data-v-7271fefd><div class="columns is-centered" data-v-7271fefd><div class="column image-container" data-v-7271fefd><img src="/images/posts/cluster-settings-mongo/local-threshold.png" alt="Konfiguracja ClusterSettings w MongoDB Java Driver" data-v-7271fefd></div></div></div></div></header><div class="section"><div class="columns is-centered"><div class="column is-two-thirds-tablet is-half-desktop"><!----><div class="content"><p>Powszechnie wykorzystywane klienty do łączenia się z bazą danych dostarczają wiele funkcjonalności i możliwości konfiguracji, które można przeoczyć - a są bardzo przydatne i mogą zoptymalizować działanie usługi. Warto poznać parę przydatnych settingsów, które potencjalnie można przetestować.</p>
<h3 id="czym-są-drivery">Czym są drivery?</h3>
<p>Drivery działają z reguły w taki sposób, że zarządzają połączeniami otwieranymi do bazy danych, dostarczając przydatne funkcje i logikę - na przykład ograniczeniem puli połączeń czy eliminacji gorzej działających hostów. Owrapowują całą logikę w przyjazny interfejs api, odciążając programistę od rozumienia internali Takich rzeczy raczej nie opłaca się implementować samemu od zera, ale nie oznacza to że jest to niewykonalne. Są różne drivery i można nawet do nich kontrybuować, bo w większości przypadków są open-source.</p>
<h3 id="clustersettings">ClusterSettings</h3>
<p>Klaster to grupa hostów mongo, które udostępniają razem pewien zbiór danych, składa się z shardów (opcjonalnie), config serverów i replica setów. Ustawienia dotyczące klastra można skonfigurować za pomocą klasy <code>ClusterSettings</code>, która zawiera takie modyfikowalne elementy jak lista hostów, do których chcemy się łączyć, nazwa replicasetu, różne polityki wybierania hostów, którego wykorzystamy do wysłania zapytania do bazy.</p>
<h3 id="localthreshold">localThreshold</h3>
<p>Umożliwia sterownikowi wybrać hosty, które mają najszybszy czas odpowiedzi i są na maszynach fizycznych w najbliższej możliwej lokalizacji - na przykład w ramach jednego datacenter. Parametr <code>localTreshold</code> to próg czasu, który zaczyna być odliczany od momentu uzyskania najszybszej odpowiedzi z serwera mongo. Wszystkie hosty, które odpowiedzą w zadanym okresie (ping najszybszego serwera + czas local threshold) zostaną zakwalifikowane do wykonywania żądań do bazy. Najlepiej obrazuje to rysunek:</p>
<p><img src="/images/posts/cluster-settings-mongo/local-threshold.png" alt="Wizualizacja Local Threshold" title="Wizualizacja Local Threshold"></p>
<p>Przykładowo: istnieją 3 serwery mongod, które odpowiadają w czasie <code>5ms</code>, <code>9ms</code> i <code>27ms</code>. Ustawiono na sterowniku <code>localThreshold=20ms</code>. Jako że najszybszy czas odpowiedzi to 5ms, a jeszcze do niego należy doliczyć zdefiniowany threshold czyli <code>20ms</code>, to łącznie maksymalny czas odpowiedzi wyniesie <code>25ms</code>. Serwer odpowiadający w czasie 9ms zakwalifikuje się do serwowania danych, natomiast serwer któremu odpowiedź zajęła <code>27ms</code> zostaje odrzucony - ponieważ akceptowano czas maksymalny <code>25ms</code>. </p>
<p>Jeśli zostanie utracona łączność z serwerem, który wcześniej odpowiadał w <code>5ms</code>, a zostaną nam dwa serwery z <code>9ms</code> i <code>27ms</code>, to wybierzemy oba, ponieważ local threshold się przesunął (<code>9ms + 20ms = 29ms</code>).</p>
<p>Na dopasowanie tego parametru nie ma uniwersalnego wzoru i trzeba go skonfigurować zgodnie z realnymi czasami z własnych dc, przydatne mogą być w tym celu metryki czasów odpowiedzi. Raczej nie ma większego powodu, by w normalnym trybie działania aplikacji odpytywać nie-lokalne datacenter, a sam <code>localThreshold</code> jest na tyle elastyczny, że może się przesuwać podczas awarii jednej serwerowni i nie odetnie usługi od bazy danych tylko przekieruje do innego datacenter. </p>
<p>Domyślnie wartość ta przyjmuje <code>15ms</code> w sterowniku javowym, więc raczej nie ma co się niepokoić że aktualnie ruch krąży między dc - chyba że datacenters mają bardzo szybkie czasy odpowiedzi między sobą.</p>
<p>Przykładowa konfiguracja:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #8FBCBB">MongoClient</span><span style="color: #D8DEE9FF"> mongoClient </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">MongoClients</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">create</span><span style="color: #ECEFF4">(</span>
<span style="color: #D8DEE9FF">                </span><span style="color: #8FBCBB">MongoClientSettings</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">builder</span><span style="color: #ECEFF4">()</span>
<span style="color: #D8DEE9FF">                        .</span><span style="color: #88C0D0">applyToClusterSettings</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">builder </span><span style="color: #81A1C1">-&gt;</span>
<span style="color: #D8DEE9FF">                                builder</span>
<span style="color: #D8DEE9FF">                                        .</span><span style="color: #88C0D0">hosts</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">Collections</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">singletonList</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">new</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">ServerAddress</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">mongos.somedomain.local</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF">, </span><span style="color: #B48EAD">27017</span><span style="color: #D8DEE9FF">)</span><span style="color: #ECEFF4">))</span>
<span style="color: #D8DEE9FF">                                        .</span><span style="color: #88C0D0">localThreshold</span><span style="color: #ECEFF4">(</span><span style="color: #B48EAD">50</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">TimeUnit</span><span style="color: #81A1C1">.</span><span style="color: #D8DEE9">MILLISECONDS</span><span style="color: #ECEFF4">)</span>
<span style="color: #D8DEE9FF">                        </span><span style="color: #ECEFF4">)</span>
<span style="color: #D8DEE9FF">                        .</span><span style="color: #88C0D0">build</span><span style="color: #ECEFF4">())</span></code></pre>
<h3 id="serverselectiontimeout">serverSelectionTimeout</h3>
<p>Podobnie jak localThreshold, umożliwia sterownikowi odseparowanie hostów z najgorszymi czasami odpowiedzi. Tym razem to jest maksymalny czas, po którym przestaniemy uwzględniać tego hosta. Może być przydatny w momencie, gdy wszystkie hosty będą przeciążone i nie warto już dociążać ich bardziej.</p>
<p>Przykładowo, wszystkie hosty są obciążone i mają ping <code>470ms</code>, <code>490ms</code>, <code>550ms</code>. Przy <code>serverSelectionTimeout=500ms</code> odrzucimy hosta który odpowiedział sumarycznie w czasie <code>550ms</code>.</p>
<p>Domyślnie przyjmuje wartość <code>30s</code>.</p>
<p>Przykładowa konfiguracja:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #8FBCBB">MongoClient</span><span style="color: #D8DEE9FF"> mongoClient </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">MongoClients</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">create</span><span style="color: #ECEFF4">(</span>
<span style="color: #D8DEE9FF">                </span><span style="color: #8FBCBB">MongoClientSettings</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">builder</span><span style="color: #ECEFF4">()</span>
<span style="color: #D8DEE9FF">                        .</span><span style="color: #88C0D0">applyToClusterSettings</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">builder </span><span style="color: #81A1C1">-&gt;</span>
<span style="color: #D8DEE9FF">                                builder</span>
<span style="color: #D8DEE9FF">                                        .</span><span style="color: #88C0D0">hosts</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">Collections</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">singletonList</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">new</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">ServerAddress</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">mongos.somedomain.local</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF">, </span><span style="color: #B48EAD">27017</span><span style="color: #D8DEE9FF">)</span><span style="color: #ECEFF4">))</span>
<span style="color: #D8DEE9FF">                              .</span><span style="color: #88C0D0">serverSelectionTimeout</span><span style="color: #ECEFF4">(</span><span style="color: #B48EAD">500</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">TimeUnit</span><span style="color: #81A1C1">.</span><span style="color: #D8DEE9">MILLISECONDS</span><span style="color: #ECEFF4">)</span>
<span style="color: #D8DEE9FF">                        </span><span style="color: #ECEFF4">)</span>
<span style="color: #D8DEE9FF">                        .</span><span style="color: #88C0D0">build</span><span style="color: #ECEFF4">())</span><span style="color: #81A1C1">;</span></code></pre>
<h3 id="requiredreplicasetname">requiredReplicaSetName</h3>
<p>Nazwa replicasetu, z którym aplikacja ma się połączyć. Przydatne, jeśli istnieje wiele replicasetów na jednym klastrze. </p>
<h3 id="clusterlistener">clusterListener</h3>
<p>Listener, dzięki któremu można nasłuchiwać na zdarzenia związane z klastrem - połączenie, zmianę, zamknięcie połączenia. Przydatne przy zbieraniu metryk, debugowaniu, integracjach z bibliotekami. Aby to wykorzystać, należy zaimplementować metody w interfejsie ClusterListener (jawnie lub zaimplementować jako nową klasę).</p>
<p>Przykładowa konfiguracja:</p>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #8FBCBB">MongoClient</span><span style="color: #D8DEE9FF"> mongoClient </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">MongoClients</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">create</span><span style="color: #ECEFF4">(</span>
<span style="color: #D8DEE9FF">                </span><span style="color: #8FBCBB">MongoClientSettings</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">builder</span><span style="color: #ECEFF4">()</span>
<span style="color: #D8DEE9FF">                        .</span><span style="color: #88C0D0">applyToClusterSettings</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">builder </span><span style="color: #81A1C1">-&gt;</span>
<span style="color: #D8DEE9FF">                                builder</span>
<span style="color: #D8DEE9FF">                                        .</span><span style="color: #88C0D0">hosts</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">Collections</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">singletonList</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">new</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">ServerAddress</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">mongos.somedomain.local</span><span style="color: #ECEFF4">"</span><span style="color: #D8DEE9FF">, </span><span style="color: #B48EAD">27017</span><span style="color: #D8DEE9FF">)</span><span style="color: #ECEFF4">))</span>
<span style="color: #D8DEE9FF">                                        .</span><span style="color: #88C0D0">addClusterListener</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">new</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">ClusterListener</span><span style="color: #D8DEE9FF">() </span><span style="color: #ECEFF4">{</span>
<span style="color: #D8DEE9FF">                                            </span><span style="color: #D08770">@Override</span>
<span style="color: #D8DEE9FF">                                            </span><span style="color: #81A1C1">public</span><span style="color: #88C0D0"> </span><span style="color: #81A1C1">void</span><span style="color: #88C0D0"> clusterOpening(</span><span style="color: #8FBCBB">ClusterOpeningEvent</span><span style="color: #88C0D0"> </span><span style="color: #D8DEE9">event</span><span style="color: #88C0D0">) </span><span style="color: #ECEFF4">{</span>
<span style="color: #88C0D0">                                                logger</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">info</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">Successfully connected to cluster with id: {}</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">,</span><span style="color: #88C0D0"> event</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">getClusterId</span><span style="color: #ECEFF4">())</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                                registerMetrics</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">event</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                                sendSomeInfoSomewhere</span><span style="color: #ECEFF4">()</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                                doSomething</span><span style="color: #ECEFF4">()</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                            </span><span style="color: #ECEFF4">}</span>

<span style="color: #D8DEE9FF">                                            </span><span style="color: #D08770">@Override</span>
<span style="color: #D8DEE9FF">                                            </span><span style="color: #81A1C1">public</span><span style="color: #88C0D0"> </span><span style="color: #81A1C1">void</span><span style="color: #88C0D0"> clusterClosed(</span><span style="color: #8FBCBB">ClusterClosedEvent</span><span style="color: #88C0D0"> </span><span style="color: #D8DEE9">event</span><span style="color: #88C0D0">) </span><span style="color: #ECEFF4">{</span>
<span style="color: #88C0D0">                                                logger</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">info</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">Connection to cluster closed with id: {}</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">,</span><span style="color: #88C0D0"> event</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">getClusterId</span><span style="color: #ECEFF4">())</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                                sendSomeInfoSomewhere</span><span style="color: #ECEFF4">()</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                            </span><span style="color: #ECEFF4">}</span>

<span style="color: #D8DEE9FF">                                            </span><span style="color: #D08770">@Override</span>
<span style="color: #D8DEE9FF">                                            </span><span style="color: #81A1C1">public</span><span style="color: #88C0D0"> </span><span style="color: #81A1C1">void</span><span style="color: #88C0D0"> clusterDescriptionChanged(</span><span style="color: #8FBCBB">ClusterDescriptionChangedEvent</span><span style="color: #88C0D0"> </span><span style="color: #D8DEE9">event</span><span style="color: #88C0D0">) </span><span style="color: #ECEFF4">{</span>
<span style="color: #88C0D0">                                                logger</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">info</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">Cluster description changed with id: {}</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">,</span><span style="color: #88C0D0"> event</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">getClusterId</span><span style="color: #ECEFF4">())</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                                doSomething</span><span style="color: #ECEFF4">()</span><span style="color: #81A1C1">;</span>
<span style="color: #88C0D0">                                            </span><span style="color: #ECEFF4">}</span>
<span style="color: #D8DEE9FF">                                        </span><span style="color: #ECEFF4">})</span>
<span style="color: #D8DEE9FF">                        </span><span style="color: #ECEFF4">)</span></code></pre>
<h3 id="dokumentacja-mongodb">Dokumentacja MongoDB</h3>
<p>Zachęcam do skorzystania z <a href="http://mongodb.github.io/mongo-java-driver/4.3/apidocs/mongodb-driver-core/com/mongodb/connection/ClusterSettings.Builder.html" target="_blank" rel="nofollow noopener noreferrer">dokumentacji mongo-java-drivera dla ClusterSettings</a>. Można tu znaleźć wiele przydatnych informacji na temat tych i innych parametrów. O parametrach można przeczytać również w <a href="https://github.com/mongodb/specifications/blob/master/source/server-selection/server-selection.rst#localthresholdms" target="_blank" rel="nofollow noopener noreferrer">oficjalnych wytycznych</a>_.</p>
<p>To kilka przydatnych wartości, które warto znać i świadomie wykorzystywać. </p>
</div><footer><div class="tags are-medium"><a href="/tag/mongodb/" class="tag is-dark is-rounded is-normal">
        mongodb
      </a><a href="/tag/java/" class="tag is-dark is-rounded is-normal">
        java
      </a><a href="/tag/data/" class="tag is-dark is-rounded is-normal">
        data
      </a><a href="/tag/database/" class="tag is-dark is-rounded is-normal">
        database
      </a></div><hr><div class="card"><div class="card-content"><div class="media"><div class="media-left"><figure class="image is-48x48"><a href="/author/Julia/"><img alt="Julia" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1280 1280' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-57b0b776eaf0c46a5fe80435581e66b4'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-57b0b776eaf0c46a5fe80435581e66b4)' width='1280' height='1280' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAgMBAQEBAAAAAAAAAAAABQcEBggDAQAC/8QAMxAAAQMDAwEGBAQHAAAAAAAAAQIDBAAFEQYSITEHEyJBUWEycYGRFELB0QgVIzNSobH/xAAZAQADAQEBAAAAAAAAAAAAAAABAgQDAAX/xAAfEQACAgMAAgMAAAAAAAAAAAAAAQIDERIhMUEEIjL/2gAMAwEAAhEDEQA/ANCAV1QOK/AroOlA4WXb1eV27TDERpW1UpwleD%2bVIzj7kUldCPRIt1Rcbgy46yyeVJx4VHocHr9Kun8R1yDt4hwkHIZaGR7k5/aq7pLs/k3a1Q7hvPdunftCtpwCR6HqKScko9KaYtvg8rNcbfMhofjvAoPIVVa7TtkzS1xQl1BIbKkgkZyOf0rhbrGu3adlRo7qi%2bo7ULz0OOaUl7tF3gImPSoofbO5K3HArKR5K56HPpUse%2byuS16V/T1nf1BOehxnWmTjeVOEgbQcEf8AKOXHs6uQi94l2OQ0AkpSDk88Hn6Chegp5g3sOpQFnaRtPnmmYNWPoAAhpCU8jCyDVicn4PPcV5NBpr11YbbUpRwEjJPtXyKD6zliDpa6yN2NkdeD7kY/WufgzS9GXO0m5m86plPAk73dqfYdB/rFM3R19VCtdvhzFIjsd13aFdMqHkT0H60iLjIU7LUoE7s7s%2bmaaXZvfrdeYi7XdFIalIG0hZ4X7isLk9UX0OO2GXuM9dg00w7Mtb0FKyorQT3hT7AdKDdo2qLe9o%2b4MIWkyAktkAfmrpcNN2m3NrlypTK4yBu8WE/Q460m9c6pbubibdbkIERsjctIxux0A9qwhFylwoulGEc5IGhx3mo4rROA54efWnCqxEj4k/Y0rezOD%2bL1vZGSThbwz8ua1WrTEQ4wV9efFVmTzXwsT77UZhx59xLbSElSlqOAkDzJpMdresRe7UbXYVFcdw5eeI2hYHQDPOPPpU7ti1QGprVlS7sYQgOvgdXFn4U/IDk/MelK1uQypwEOFSlHH3pLJtcQ9NafWUR1stPOhQOfX3ryzpDt0CSSCehHrR/VcdqM33zeNzvhAHl61L7LIcOZqRDMsI71SSWt3moYPH2NBzzDJooYmkFYmnnbgjvZrzyozSSrapRNKpCkvXJZTwlSlbfl5VpntFLdq0Xdn2kJQRHKEkf5K8Ix96zJbAP5pFB6FwChRlxbD8lraKRddJPO2q6Rbg1/djqyn5itSaQ1ladTw0KhyW0ysf1Iy1YWg%2bfB6isp6meEG3tojKKXCv4gecCgke%2byW1pcUhPep5DicpUPqKNeX9kJao/llw1JcHb3qabcZK9qXnVLSg9dufCPbjFRo0d1x8OIzsSQon9qEIStUxRkLygEcepqwO3RLEUNspAWU%2bHPRPufehZlD14IN/d/FTC3jwNJ2g%2b/U0EZnPWudGmxFBL8Z0OoJ6ZB8/apa3gMIHKj5%2bvNQix3ylZPTNdHiwCXR3a2uSdU9kcidASXC62lam2/EUKChuSfcc/Ss5ocLbyHEnlKgofejjN9ulvtUq0Q5a2YUtQU6hJwTgYxnyB8/XAoM42Egeas1rXDRNGNk92mHbk6JbqS4coTyfkajzUxnUITFSQoHCs1DLwLRBJHGM1Ps7ae7LijwfM0qWqHzsz/2Q==' /%3e%3c/svg%3e" width="1280" data-src="/assets/static/avatarLg.7c86909.3a4b1105ba454ab12990d76531f1ff35.jpeg" data-srcset="/assets/static/avatarLg.82a2fbd.3a4b1105ba454ab12990d76531f1ff35.jpeg 480w, /assets/static/avatarLg.7c86909.3a4b1105ba454ab12990d76531f1ff35.jpeg 1280w" data-sizes="(max-width: 1280px) 100vw, 1280px" class="is-rounded g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/avatarLg.7c86909.3a4b1105ba454ab12990d76531f1ff35.jpeg" class="is-rounded g-image g-image--loaded" width="1280" alt="Julia"></noscript></a></figure></div><div class="media-content"><p class="title is-4"><a href="/author/Julia/">
            Julia</a></p><p class="subtitle is-6">julia.anna.glaszka@interia.pl</p></div></div><div class="content"><p> Pasjonuję się IT, ekonomią i muzyką. 
    Od 2019 siedzę z tyłu, bawiąc się backendem, systemami i infrastrukturą - głównie przez to, 
    że strasznie podobaja mi się idea mikroserwisów i chciałabym umieć zaprojektować wydajną architekturę na potrzeby różnych case'ów biznesowych.
    Moim ulubionym językiem jest Java i w niej pracuję na codzień, umiem też kodzić w Javascript'cie, w Kotlinie, Groovym, Golangu (i w paru innych językach). </p></div></div><footer class="card-footer"><a href="/author/Julia/" class="card-footer-item">
            See all posts by Julia →</a></footer></div></footer></div></div></div><footer class="footer has-background-primary p-t-xl"><div class="container"><div class="columns"><div class="column has-text-left"><a href="#" class="title is-4 has-text-grey">Autodydaktycznie Blog</a><br><p class="pt-5"> 
            Wynalazca to człowiek, który pyta wszechświat: &quot;Dlaczego?&quot; 
            i nie pozwala,
            by cokolwiek stanęło między odpowiedzią 
            a jego umysłem. ~ &quot;Atlas Shrugged&quot;, Ayn Rand</p><p class="pt-5"><a href="/author/Julia" class="has-text-grey">O Autorce</a></p><p class="pt-1"><a href="https://www.linkedin.com/in/julia-glaszka/" target="_blank" rel="noopener" class="has-text-grey mt-5">LinkedIn</a></p></div><div class="column has-text-centered has-text-right-tablet"><p class="subtitle is-5"><span class="copyleft">©</span> juliagl</p></div></div></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Konfiguracja ClusterSettings w MongoDB Java Driver","path":"\u002Fkonfiguracja-cluster-settings-w-mongo-db-java-driver\u002F","slug":"mongodb-java-driver-cluster-settings-properties","datetime":"2021-10-07 20:22:24","content":"\u003Cp\u003EPowszechnie wykorzystywane klienty do łączenia się z bazą danych dostarczają wiele funkcjonalności i możliwości konfiguracji, które można przeoczyć - a są bardzo przydatne i mogą zoptymalizować działanie usługi. Warto poznać parę przydatnych settingsów, które potencjalnie można przetestować.\u003C\u002Fp\u003E\n\u003Ch3 id=\"czym-są-drivery\"\u003ECzym są drivery?\u003C\u002Fh3\u003E\n\u003Cp\u003EDrivery działają z reguły w taki sposób, że zarządzają połączeniami otwieranymi do bazy danych, dostarczając przydatne funkcje i logikę - na przykład ograniczeniem puli połączeń czy eliminacji gorzej działających hostów. Owrapowują całą logikę w przyjazny interfejs api, odciążając programistę od rozumienia internali Takich rzeczy raczej nie opłaca się implementować samemu od zera, ale nie oznacza to że jest to niewykonalne. Są różne drivery i można nawet do nich kontrybuować, bo w większości przypadków są open-source.\u003C\u002Fp\u003E\n\u003Ch3 id=\"clustersettings\"\u003EClusterSettings\u003C\u002Fh3\u003E\n\u003Cp\u003EKlaster to grupa hostów mongo, które udostępniają razem pewien zbiór danych, składa się z shardów (opcjonalnie), config serverów i replica setów. Ustawienia dotyczące klastra można skonfigurować za pomocą klasy \u003Ccode\u003EClusterSettings\u003C\u002Fcode\u003E, która zawiera takie modyfikowalne elementy jak lista hostów, do których chcemy się łączyć, nazwa replicasetu, różne polityki wybierania hostów, którego wykorzystamy do wysłania zapytania do bazy.\u003C\u002Fp\u003E\n\u003Ch3 id=\"localthreshold\"\u003ElocalThreshold\u003C\u002Fh3\u003E\n\u003Cp\u003EUmożliwia sterownikowi wybrać hosty, które mają najszybszy czas odpowiedzi i są na maszynach fizycznych w najbliższej możliwej lokalizacji - na przykład w ramach jednego datacenter. Parametr \u003Ccode\u003ElocalTreshold\u003C\u002Fcode\u003E to próg czasu, który zaczyna być odliczany od momentu uzyskania najszybszej odpowiedzi z serwera mongo. Wszystkie hosty, które odpowiedzą w zadanym okresie (ping najszybszego serwera + czas local threshold) zostaną zakwalifikowane do wykonywania żądań do bazy. Najlepiej obrazuje to rysunek:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fposts\u002Fcluster-settings-mongo\u002Flocal-threshold.png\" alt=\"Wizualizacja Local Threshold\" title=\"Wizualizacja Local Threshold\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EPrzykładowo: istnieją 3 serwery mongod, które odpowiadają w czasie \u003Ccode\u003E5ms\u003C\u002Fcode\u003E, \u003Ccode\u003E9ms\u003C\u002Fcode\u003E i \u003Ccode\u003E27ms\u003C\u002Fcode\u003E. Ustawiono na sterowniku \u003Ccode\u003ElocalThreshold=20ms\u003C\u002Fcode\u003E. Jako że najszybszy czas odpowiedzi to 5ms, a jeszcze do niego należy doliczyć zdefiniowany threshold czyli \u003Ccode\u003E20ms\u003C\u002Fcode\u003E, to łącznie maksymalny czas odpowiedzi wyniesie \u003Ccode\u003E25ms\u003C\u002Fcode\u003E. Serwer odpowiadający w czasie 9ms zakwalifikuje się do serwowania danych, natomiast serwer któremu odpowiedź zajęła \u003Ccode\u003E27ms\u003C\u002Fcode\u003E zostaje odrzucony - ponieważ akceptowano czas maksymalny \u003Ccode\u003E25ms\u003C\u002Fcode\u003E. \u003C\u002Fp\u003E\n\u003Cp\u003EJeśli zostanie utracona łączność z serwerem, który wcześniej odpowiadał w \u003Ccode\u003E5ms\u003C\u002Fcode\u003E, a zostaną nam dwa serwery z \u003Ccode\u003E9ms\u003C\u002Fcode\u003E i \u003Ccode\u003E27ms\u003C\u002Fcode\u003E, to wybierzemy oba, ponieważ local threshold się przesunął (\u003Ccode\u003E9ms + 20ms = 29ms\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\u003Cp\u003ENa dopasowanie tego parametru nie ma uniwersalnego wzoru i trzeba go skonfigurować zgodnie z realnymi czasami z własnych dc, przydatne mogą być w tym celu metryki czasów odpowiedzi. Raczej nie ma większego powodu, by w normalnym trybie działania aplikacji odpytywać nie-lokalne datacenter, a sam \u003Ccode\u003ElocalThreshold\u003C\u002Fcode\u003E jest na tyle elastyczny, że może się przesuwać podczas awarii jednej serwerowni i nie odetnie usługi od bazy danych tylko przekieruje do innego datacenter. \u003C\u002Fp\u003E\n\u003Cp\u003EDomyślnie wartość ta przyjmuje \u003Ccode\u003E15ms\u003C\u002Fcode\u003E w sterowniku javowym, więc raczej nie ma co się niepokoić że aktualnie ruch krąży między dc - chyba że datacenters mają bardzo szybkie czasy odpowiedzi między sobą.\u003C\u002Fp\u003E\n\u003Cp\u003EPrzykładowa konfiguracja:\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #2e3440\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClient\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E mongoClient \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E=\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClients\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ecreate\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClientSettings\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ebuilder\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EapplyToClusterSettings\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003Ebuilder \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E-&gt;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                builder\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ehosts\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003ECollections\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EsingletonList\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EServerAddress\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003Emongos.somedomain.local\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E, \u003C\u002Fspan\u003E\u003Cspan style=\"color: #B48EAD\"\u003E27017\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E))\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003ElocalThreshold\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #B48EAD\"\u003E50\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E,\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003ETimeUnit\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9\"\u003EMILLISECONDS\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ebuild\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"serverselectiontimeout\"\u003EserverSelectionTimeout\u003C\u002Fh3\u003E\n\u003Cp\u003EPodobnie jak localThreshold, umożliwia sterownikowi odseparowanie hostów z najgorszymi czasami odpowiedzi. Tym razem to jest maksymalny czas, po którym przestaniemy uwzględniać tego hosta. Może być przydatny w momencie, gdy wszystkie hosty będą przeciążone i nie warto już dociążać ich bardziej.\u003C\u002Fp\u003E\n\u003Cp\u003EPrzykładowo, wszystkie hosty są obciążone i mają ping \u003Ccode\u003E470ms\u003C\u002Fcode\u003E, \u003Ccode\u003E490ms\u003C\u002Fcode\u003E, \u003Ccode\u003E550ms\u003C\u002Fcode\u003E. Przy \u003Ccode\u003EserverSelectionTimeout=500ms\u003C\u002Fcode\u003E odrzucimy hosta który odpowiedział sumarycznie w czasie \u003Ccode\u003E550ms\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EDomyślnie przyjmuje wartość \u003Ccode\u003E30s\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EPrzykładowa konfiguracja:\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #2e3440\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClient\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E mongoClient \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E=\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClients\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ecreate\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClientSettings\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ebuilder\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EapplyToClusterSettings\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003Ebuilder \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E-&gt;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                builder\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ehosts\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003ECollections\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EsingletonList\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EServerAddress\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003Emongos.somedomain.local\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E, \u003C\u002Fspan\u003E\u003Cspan style=\"color: #B48EAD\"\u003E27017\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E))\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                              .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EserverSelectionTimeout\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #B48EAD\"\u003E500\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E,\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003ETimeUnit\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9\"\u003EMILLISECONDS\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ebuild\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"requiredreplicasetname\"\u003ErequiredReplicaSetName\u003C\u002Fh3\u003E\n\u003Cp\u003ENazwa replicasetu, z którym aplikacja ma się połączyć. Przydatne, jeśli istnieje wiele replicasetów na jednym klastrze. \u003C\u002Fp\u003E\n\u003Ch3 id=\"clusterlistener\"\u003EclusterListener\u003C\u002Fh3\u003E\n\u003Cp\u003EListener, dzięki któremu można nasłuchiwać na zdarzenia związane z klastrem - połączenie, zmianę, zamknięcie połączenia. Przydatne przy zbieraniu metryk, debugowaniu, integracjach z bibliotekami. Aby to wykorzystać, należy zaimplementować metody w interfejsie ClusterListener (jawnie lub zaimplementować jako nową klasę).\u003C\u002Fp\u003E\n\u003Cp\u003EPrzykładowa konfiguracja:\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #2e3440\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClient\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E mongoClient \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E=\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClients\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ecreate\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClientSettings\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ebuilder\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EapplyToClusterSettings\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003Ebuilder \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E-&gt;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                builder\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ehosts\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003ECollections\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EsingletonList\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EServerAddress\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003Emongos.somedomain.local\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E, \u003C\u002Fspan\u003E\u003Cspan style=\"color: #B48EAD\"\u003E27017\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E))\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                        .\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EaddClusterListener\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EClusterListener\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E() \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #D08770\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E clusterOpening(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EClusterOpeningEvent\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9\"\u003Eevent\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E) \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                logger\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Einfo\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003ESuccessfully connected to cluster with id: {}\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E,\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E event\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EgetClusterId\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                registerMetrics\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Eevent\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                sendSomeInfoSomewhere\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                doSomething\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #D08770\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E clusterClosed(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EClusterClosedEvent\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9\"\u003Eevent\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E) \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                logger\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Einfo\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003EConnection to cluster closed with id: {}\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E,\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E event\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EgetClusterId\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                sendSomeInfoSomewhere\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #D08770\"\u003E@Override\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E clusterDescriptionChanged(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EClusterDescriptionChangedEvent\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9\"\u003Eevent\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E) \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                logger\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Einfo\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003ECluster description changed with id: {}\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E,\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003E event\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EgetClusterId\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                                doSomething\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #88C0D0\"\u003E                                            \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                                        \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E})\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E                        \u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"dokumentacja-mongodb\"\u003EDokumentacja MongoDB\u003C\u002Fh3\u003E\n\u003Cp\u003EZachęcam do skorzystania z \u003Ca href=\"http:\u002F\u002Fmongodb.github.io\u002Fmongo-java-driver\u002F4.3\u002Fapidocs\u002Fmongodb-driver-core\u002Fcom\u002Fmongodb\u002Fconnection\u002FClusterSettings.Builder.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Edokumentacji mongo-java-drivera dla ClusterSettings\u003C\u002Fa\u003E. Można tu znaleźć wiele przydatnych informacji na temat tych i innych parametrów. O parametrach można przeczytać również w \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmongodb\u002Fspecifications\u002Fblob\u002Fmaster\u002Fsource\u002Fserver-selection\u002Fserver-selection.rst#localthresholdms\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eoficjalnych wytycznych\u003C\u002Fa\u003E_.\u003C\u002Fp\u003E\n\u003Cp\u003ETo kilka przydatnych wartości, które warto znać i świadomie wykorzystywać. \u003C\u002Fp\u003E\n","description":"Konfiguracja ClusterSettings w MongoDB Java Driver","timeToRead":3,"cover":"\u002Fimages\u002Fposts\u002Fcluster-settings-mongo\u002Flocal-threshold.png","author":{"id":"Julia","title":"Julia","path":"\u002Fauthor\u002FJulia\u002F"},"tags":[{"id":"mongodb","title":"mongodb","path":"\u002Ftag\u002Fmongodb\u002F"},{"id":"java","title":"java","path":"\u002Ftag\u002Fjava\u002F"},{"id":"data","title":"data","path":"\u002Ftag\u002Fdata\u002F"},{"id":"database","title":"database","path":"\u002Ftag\u002Fdatabase\u002F"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.638d8796.js" defer></script><script src="/assets/js/page--src--templates--post-vue.e461cfa3.js" defer></script>
  </body>
</html>
