{"hash":"104e64b551b796adece47e4348221e71124802f9","data":{"tag":{"id":"data","title":"data","path":"/tag/data/","belongsTo":{"totalCount":4,"pageInfo":{"totalPages":1,"currentPage":1},"edges":[{"node":{"id":"507900b37c02db543d8fa26f4705fb1e","title":"Wykorzystaj cały potencjał klastra MongoDB z pomocą preferencji odczytu","datetime":"2021-11-15 18:37:24","path":"/wykorzystaj-caly-potencjal-klastra-mongo-db-z-pomoca-preferencji-odczytu/","content":"<h1 id=\"\"></h1>\n<p>Typowy produkcyjny klaster jest zbudowany z co najmniej jednego ReplicaSetu. To oznacza, że posiadamy co najmniej jeden węzeł Primary (realizujący zapisy i odczyty) i kilka Secondary (tylko do odczytu). Domyślne ustawienia konfiguracji sterowników kierują ruch wyłącznie do Primary, rezygnując z używania pozostałych hostów. To oznacza, że obciążony jest tylko jeden node, a reszta pozostaje bierna - zasoby pod względem load-balancingu są marnowane. W przypadku awarii Mastera tracimy też możliwość odczytów, które mogłyby być nadal realizowane przez Secondary.</p>\n<p>Zatem w jaki sposób można wymusić kierowanie ruchu do innych hostów niż Primary? Z pomocą przychodzą nam preferencje odczytu - tzw. <code>ReadPreference</code>. Posiada on różne tryby, pozwalające na wybranie algorytmu poszukiwania hosta, do którego wyślemy query.</p>\n<h2 id=\"konfiguracja-preferencji-odczytu-w-driverze\">Konfiguracja preferencji odczytu w driverze</h2>\n<p>Ustawienia <code>ReadPreference</code> można zdefiniować w kilku miejscach:</p>\n<ul>\n<li>na poziomie klastra:</li>\n</ul>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">MongoClient</span><span style=\"color: #D8DEE9FF\"> mongoClient </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">MongoClients</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">create</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #8FBCBB\">MongoClientSettings</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">builder</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #D8DEE9FF\">  </span>\n<span style=\"color: #D8DEE9FF\">.</span><span style=\"color: #88C0D0\">hosts</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\">listOfHostsUrls</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">.</span><span style=\"color: #88C0D0\">readPreference</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #8FBCBB\">ReadPreference</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">secondary</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #D8DEE9FF\">  </span>\n<span style=\"color: #D8DEE9FF\">.</span><span style=\"color: #88C0D0\">build</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #81A1C1\">;</span></code></pre>\n<ul>\n<li>na poziomie bazy danych</li>\n</ul>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">MongoDatabase</span><span style=\"color: #D8DEE9FF\"> database </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> mongoClient</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">getDatabase</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">someDatabase</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\">  </span>\n<span style=\"color: #D8DEE9FF\">.</span><span style=\"color: #88C0D0\">withReadPreference</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #8FBCBB\">ReadPreference</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">secondary</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #81A1C1\">;</span></code></pre>\n<ul>\n<li>na poziomie kolekcji</li>\n</ul>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">MongoCollection&lt;Document&gt;</span><span style=\"color: #D8DEE9FF\"> collection </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> database</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">getCollection</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">videos</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\">  </span>\n<span style=\"color: #D8DEE9FF\">.</span><span style=\"color: #88C0D0\">withReadPreference</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #8FBCBB\">ReadPreference</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">secondary</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #81A1C1\">;</span></code></pre>\n<p>Podane ustawienia mogą zmieniać działanie usługi, jeśli na przykład posiada na klastrze kilka różnych baz danych z różnymi kolekcjami. Może być tak, że nie dla wszystkich kolekcji można sobie pozwolić na odczyt z Secondary - np. gdy potrzebujemy wyższy poziom consistency.</p>\n<h2 id=\"tryby-odczytu\">Tryby odczytu</h2>\n<h3 id=\"primary\">primary</h3>\n<p>Domyślny dla wielu driverów. Kieruje ruch wyłącznie do hosta typu Primary, co może być znaczącą barierą w skalowaniu usługi pod kątem odczytów.</p>\n<h3 id=\"primarypreferred\">primaryPreferred</h3>\n<p>W tej preferencji w głównej mierze odczytujemy z hosta Primary, ale w przypadku gdy będzie niedostępny to odczyty zostaną przekierowana do innych replik typu Secondary.</p>\n<h3 id=\"secondary\">secondary</h3>\n<p>Wszystkie odczyty są kierowane do Secondary.</p>\n<h3 id=\"secondarypreferred\">secondaryPreferred</h3>\n<p>W większości przypadków odczytujemy z Secondary, ale przy awarii wszystkich hostów ruch może zostać przekierowany do Primary.</p>\n<h3 id=\"nearest\">nearest</h3>\n<p>Driver selekcjonuje zdrowe hosty z odpowiednio krótkim czasem odpowiedzi, tak by odpowiedziały maksymalnie szybko - np w ramach jednego datacenter. Następnie losowo wybierany jest jeden host, który zrealizuje żądanie. Nie jest uwzględniane czy node jest Primary czy Secondary.</p>\n<h2 id=\"jaki-tryb-odczytu-wybrać\">Jaki tryb odczytu wybrać?</h2>\n<p>W przypadku usługi typu heavy read z eventual consistency najbardziej optymalne będzie odczytywanie z preferencjami: <code>nearest</code>, <code>secondaryPreferred</code> lub <code>secondary</code>. Wybór konkretnej preferencji zależałby w tym przypadku od ilości zapisów oraz posiadanych hostów i zasobów. Jeśli usługa bardzo dużo zapisuje i Primary jest już dostatecznie obciążony, można rozważyć unikanie dociążania Primary poprzez preferencję <code>secondary</code> lub <code>secondaryPreferred</code>.</p>\n<p>Ostateczny wybór między pozostałymi dwoma typami odczytów może rozstrzygnąć to - czy bardziej zależy nam na stabilności odczytów czy zapisów. SecondaryPreferred dostarcza n+1 hostów, natomiast samo secondary tylko n (bo nie uwzględnia Primary).</p>\n<p>W sytuacji niespodziewanie większego ruchu warto mieć więcej dostępnych hostów niż mniej, ale analizując z drugiej strony - ten jeden dodatkowy host to Primary, jeśli zostanie obciążony to doprowadzi to również do niestabilności zapisów. Jeśli usługa nie posiada mechanizmów ponowień takich jak klienci z ponowieniami lub message queue, to dane mogą zostać niezapisane, co skłaniałoby do użycia preferencji secondary - wtedy awaria dotyczyłaby tylko odczytów.</p>\n<h2 id=\"po-wdrożeniu\">Po wdrożeniu</h2>\n<p>Po wdrożeniu nowego typu preferencji warto mieć wgląd w metryki:</p>\n<ul>\n<li>czasów odpowiedzi usługi</li>\n<li>czasów odpowiedzi bazy danych do usługi</li>\n<li>load, zajętość ramu, ilość rps do kolekcji, obciążenie sieciowe klastra mongo</li>\n</ul>\n<h2 id=\"podsumowanie\">Podsumowanie</h2>\n<p>Jak widać, każde takie ustawienie trzeba samodzielnie przeanalizować, uwzględniając swoje własne wymagania względem stabilności. Wybranie konkretnej preferencji odczytu może mieć dalekosiężne skutki, dlatego przed wyborem zawsze warto się dłużej zastanowić i przeanalizować słabe punkty konkretnego rozwiązania. Polecam również zapoznać się z <a href=\"https://docs.mongodb.com/manual/core/read-preference/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">oficjalną dokumentacją</a>.</p>\n","excerpt":" Typowy produkcyjny klaster jest zbudowany z co najmniej jednego ReplicaSetu. To oznacza, że posiadamy co najmniej jeden węzeł Primary (realizujący zapisy i odczyty) i kilka Secondary (tylko do","description":"Wykorzystaj cały potencjał klastra MongoDB z pomocą preferencji odczytu","cover":"/images/posts/mongodb-read-preferences/route.jpg","timeToRead":3,"author":{"id":"Julia","title":"Julia","path":"/author/Julia/"}}},{"node":{"id":"c854d4a554f3e6aa74a421fac8beb243","title":"Konfiguracja ClusterSettings w MongoDB Java Driver","datetime":"2021-10-07 20:22:24","path":"/konfiguracja-cluster-settings-w-mongo-db-java-driver/","content":"<p>Powszechnie wykorzystywane klienty do łączenia się z bazą danych dostarczają wiele funkcjonalności i możliwości konfiguracji, które można przeoczyć - a są bardzo przydatne i mogą zoptymalizować działanie usługi. Warto poznać parę przydatnych settingsów, które potencjalnie można przetestować.</p>\n<h3 id=\"czym-są-drivery\">Czym są drivery?</h3>\n<p>Drivery działają z reguły w taki sposób, że zarządzają połączeniami otwieranymi do bazy danych, dostarczając przydatne funkcje i logikę - na przykład ograniczeniem puli połączeń czy eliminacji gorzej działających hostów. Owrapowują całą logikę w przyjazny interfejs api, odciążając programistę od rozumienia internali Takich rzeczy raczej nie opłaca się implementować samemu od zera, ale nie oznacza to że jest to niewykonalne. Są różne drivery i można nawet do nich kontrybuować, bo w większości przypadków są open-source.</p>\n<h3 id=\"clustersettings\">ClusterSettings</h3>\n<p>Klaster to grupa hostów mongo, które udostępniają razem pewien zbiór danych, składa się z shardów (opcjonalnie), config serverów i replica setów. Ustawienia dotyczące klastra można skonfigurować za pomocą klasy <code>ClusterSettings</code>, która zawiera takie modyfikowalne elementy jak lista hostów, do których chcemy się łączyć, nazwa replicasetu, różne polityki wybierania hostów, którego wykorzystamy do wysłania zapytania do bazy.</p>\n<h3 id=\"localthreshold\">localThreshold</h3>\n<p>Umożliwia sterownikowi wybrać hosty, które mają najszybszy czas odpowiedzi i są na maszynach fizycznych w najbliższej możliwej lokalizacji - na przykład w ramach jednego datacenter. Parametr <code>localTreshold</code> to próg czasu, który zaczyna być odliczany od momentu uzyskania najszybszej odpowiedzi z serwera mongo. Wszystkie hosty, które odpowiedzą w zadanym okresie (ping najszybszego serwera + czas local threshold) zostaną zakwalifikowane do wykonywania żądań do bazy. Najlepiej obrazuje to rysunek:</p>\n<p><img src=\"/images/posts/cluster-settings-mongo/local-threshold.png\" alt=\"Wizualizacja Local Threshold\" title=\"Wizualizacja Local Threshold\"></p>\n<p>Przykładowo: istnieją 3 serwery mongod, które odpowiadają w czasie <code>5ms</code>, <code>9ms</code> i <code>27ms</code>. Ustawiono na sterowniku <code>localThreshold=20ms</code>. Jako że najszybszy czas odpowiedzi to 5ms, a jeszcze do niego należy doliczyć zdefiniowany threshold czyli <code>20ms</code>, to łącznie maksymalny czas odpowiedzi wyniesie <code>25ms</code>. Serwer odpowiadający w czasie 9ms zakwalifikuje się do serwowania danych, natomiast serwer któremu odpowiedź zajęła <code>27ms</code> zostaje odrzucony - ponieważ akceptowano czas maksymalny <code>25ms</code>. </p>\n<p>Jeśli zostanie utracona łączność z serwerem, który wcześniej odpowiadał w <code>5ms</code>, a zostaną nam dwa serwery z <code>9ms</code> i <code>27ms</code>, to wybierzemy oba, ponieważ local threshold się przesunął (<code>9ms + 20ms = 29ms</code>).</p>\n<p>Na dopasowanie tego parametru nie ma uniwersalnego wzoru i trzeba go skonfigurować zgodnie z realnymi czasami z własnych dc, przydatne mogą być w tym celu metryki czasów odpowiedzi. Raczej nie ma większego powodu, by w normalnym trybie działania aplikacji odpytywać nie-lokalne datacenter, a sam <code>localThreshold</code> jest na tyle elastyczny, że może się przesuwać podczas awarii jednej serwerowni i nie odetnie usługi od bazy danych tylko przekieruje do innego datacenter. </p>\n<p>Domyślnie wartość ta przyjmuje <code>15ms</code> w sterowniku javowym, więc raczej nie ma co się niepokoić że aktualnie ruch krąży między dc - chyba że datacenters mają bardzo szybkie czasy odpowiedzi między sobą.</p>\n<p>Przykładowa konfiguracja:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">MongoClient</span><span style=\"color: #D8DEE9FF\"> mongoClient </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">MongoClients</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">create</span><span style=\"color: #ECEFF4\">(</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #8FBCBB\">MongoClientSettings</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">builder</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">                        .</span><span style=\"color: #88C0D0\">applyToClusterSettings</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\">builder </span><span style=\"color: #81A1C1\">-&gt;</span>\n<span style=\"color: #D8DEE9FF\">                                builder</span>\n<span style=\"color: #D8DEE9FF\">                                        .</span><span style=\"color: #88C0D0\">hosts</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #8FBCBB\">Collections</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">singletonList</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">ServerAddress</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">mongos.somedomain.local</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\">, </span><span style=\"color: #B48EAD\">27017</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #ECEFF4\">))</span>\n<span style=\"color: #D8DEE9FF\">                                        .</span><span style=\"color: #88C0D0\">localThreshold</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #B48EAD\">50</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">TimeUnit</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #D8DEE9\">MILLISECONDS</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">                        </span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">                        .</span><span style=\"color: #88C0D0\">build</span><span style=\"color: #ECEFF4\">())</span></code></pre>\n<h3 id=\"serverselectiontimeout\">serverSelectionTimeout</h3>\n<p>Podobnie jak localThreshold, umożliwia sterownikowi odseparowanie hostów z najgorszymi czasami odpowiedzi. Tym razem to jest maksymalny czas, po którym przestaniemy uwzględniać tego hosta. Może być przydatny w momencie, gdy wszystkie hosty będą przeciążone i nie warto już dociążać ich bardziej.</p>\n<p>Przykładowo, wszystkie hosty są obciążone i mają ping <code>470ms</code>, <code>490ms</code>, <code>550ms</code>. Przy <code>serverSelectionTimeout=500ms</code> odrzucimy hosta który odpowiedział sumarycznie w czasie <code>550ms</code>.</p>\n<p>Domyślnie przyjmuje wartość <code>30s</code>.</p>\n<p>Przykładowa konfiguracja:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">MongoClient</span><span style=\"color: #D8DEE9FF\"> mongoClient </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">MongoClients</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">create</span><span style=\"color: #ECEFF4\">(</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #8FBCBB\">MongoClientSettings</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">builder</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">                        .</span><span style=\"color: #88C0D0\">applyToClusterSettings</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\">builder </span><span style=\"color: #81A1C1\">-&gt;</span>\n<span style=\"color: #D8DEE9FF\">                                builder</span>\n<span style=\"color: #D8DEE9FF\">                                        .</span><span style=\"color: #88C0D0\">hosts</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #8FBCBB\">Collections</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">singletonList</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">ServerAddress</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">mongos.somedomain.local</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\">, </span><span style=\"color: #B48EAD\">27017</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #ECEFF4\">))</span>\n<span style=\"color: #D8DEE9FF\">                              .</span><span style=\"color: #88C0D0\">serverSelectionTimeout</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #B48EAD\">500</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">TimeUnit</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #D8DEE9\">MILLISECONDS</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">                        </span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">                        .</span><span style=\"color: #88C0D0\">build</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #81A1C1\">;</span></code></pre>\n<h3 id=\"requiredreplicasetname\">requiredReplicaSetName</h3>\n<p>Nazwa replicasetu, z którym aplikacja ma się połączyć. Przydatne, jeśli istnieje wiele replicasetów na jednym klastrze. </p>\n<h3 id=\"clusterlistener\">clusterListener</h3>\n<p>Listener, dzięki któremu można nasłuchiwać na zdarzenia związane z klastrem - połączenie, zmianę, zamknięcie połączenia. Przydatne przy zbieraniu metryk, debugowaniu, integracjach z bibliotekami. Aby to wykorzystać, należy zaimplementować metody w interfejsie ClusterListener (jawnie lub zaimplementować jako nową klasę).</p>\n<p>Przykładowa konfiguracja:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">MongoClient</span><span style=\"color: #D8DEE9FF\"> mongoClient </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">MongoClients</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">create</span><span style=\"color: #ECEFF4\">(</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #8FBCBB\">MongoClientSettings</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">builder</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">                        .</span><span style=\"color: #88C0D0\">applyToClusterSettings</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\">builder </span><span style=\"color: #81A1C1\">-&gt;</span>\n<span style=\"color: #D8DEE9FF\">                                builder</span>\n<span style=\"color: #D8DEE9FF\">                                        .</span><span style=\"color: #88C0D0\">hosts</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #8FBCBB\">Collections</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">singletonList</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">ServerAddress</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">mongos.somedomain.local</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\">, </span><span style=\"color: #B48EAD\">27017</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #ECEFF4\">))</span>\n<span style=\"color: #D8DEE9FF\">                                        .</span><span style=\"color: #88C0D0\">addClusterListener</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">ClusterListener</span><span style=\"color: #D8DEE9FF\">() </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                                            </span><span style=\"color: #D08770\">@Override</span>\n<span style=\"color: #D8DEE9FF\">                                            </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #88C0D0\"> clusterOpening(</span><span style=\"color: #8FBCBB\">ClusterOpeningEvent</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #D8DEE9\">event</span><span style=\"color: #88C0D0\">) </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #88C0D0\">                                                logger</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">info</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Successfully connected to cluster with id: {}</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #88C0D0\"> event</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">getClusterId</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                                registerMetrics</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #88C0D0\">event</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                                sendSomeInfoSomewhere</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                                doSomething</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                            </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">                                            </span><span style=\"color: #D08770\">@Override</span>\n<span style=\"color: #D8DEE9FF\">                                            </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #88C0D0\"> clusterClosed(</span><span style=\"color: #8FBCBB\">ClusterClosedEvent</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #D8DEE9\">event</span><span style=\"color: #88C0D0\">) </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #88C0D0\">                                                logger</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">info</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Connection to cluster closed with id: {}</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #88C0D0\"> event</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">getClusterId</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                                sendSomeInfoSomewhere</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                            </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">                                            </span><span style=\"color: #D08770\">@Override</span>\n<span style=\"color: #D8DEE9FF\">                                            </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #88C0D0\"> clusterDescriptionChanged(</span><span style=\"color: #8FBCBB\">ClusterDescriptionChangedEvent</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #D8DEE9\">event</span><span style=\"color: #88C0D0\">) </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #88C0D0\">                                                logger</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">info</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Cluster description changed with id: {}</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #88C0D0\"> event</span><span style=\"color: #81A1C1\">.</span><span style=\"color: #88C0D0\">getClusterId</span><span style=\"color: #ECEFF4\">())</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                                doSomething</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">                                            </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">                                        </span><span style=\"color: #ECEFF4\">})</span>\n<span style=\"color: #D8DEE9FF\">                        </span><span style=\"color: #ECEFF4\">)</span></code></pre>\n<h3 id=\"dokumentacja-mongodb\">Dokumentacja MongoDB</h3>\n<p>Zachęcam do skorzystania z <a href=\"http://mongodb.github.io/mongo-java-driver/4.3/apidocs/mongodb-driver-core/com/mongodb/connection/ClusterSettings.Builder.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dokumentacji mongo-java-drivera dla ClusterSettings</a>. Można tu znaleźć wiele przydatnych informacji na temat tych i innych parametrów. O parametrach można przeczytać również w <a href=\"https://github.com/mongodb/specifications/blob/master/source/server-selection/server-selection.rst#localthresholdms\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">oficjalnych wytycznych</a>_.</p>\n<p>To kilka przydatnych wartości, które warto znać i świadomie wykorzystywać. </p>\n","excerpt":"Powszechnie wykorzystywane klienty do łączenia się z bazą danych dostarczają wiele funkcjonalności i możliwości konfiguracji, które można przeoczyć - a są bardzo przydatne i mogą zoptymalizować","description":"Konfiguracja ClusterSettings w MongoDB Java Driver","cover":"/images/posts/cluster-settings-mongo/local-threshold.png","timeToRead":3,"author":{"id":"Julia","title":"Julia","path":"/author/Julia/"}}},{"node":{"id":"8fa5a7196f6a5cf6e3f3573332ce17ab","title":"Elasticsearch - to nie tylko logi.","datetime":"2020-09-07 22:56:24","path":"/elasticsearch-to-nie-tylko-logi/","content":"<p>Elasticsearch to zaawansowany silnik wyszukiwań a jednocześnie baza danych pozwalająca na przechowywanie różnych typów danych. Wykorzystywana jest głównie przy komercyjnych wyszukiwarkach oraz przy gromadzeniu logów systemowych. Dzięki Elasticsearch, możesz wykonywać skomplikowane wyszukiwania, filtry i agregacje, a także wykorzystywać słowniki.</p>\n<h3 id=\"wstępne-ustalenia\">Wstępne ustalenia</h3>\n<p>Ogólnie myślę, że sensownie będzie zapisywać działania do plików, dzięki czemu będzie łatwiej zrekonstruować listę kroków. Warto utworzyć tworzyć osobny katalog na czas ćwiczeń. Całość prawdopodobnie złożę jako projekt na githubie, więc będzie dostępny do sklonowania. </p>\n<h3 id=\"przykładowy-use-case\">Przykładowy use case</h3>\n<p>Razem z moim trzyosobowym zespołem w ramach hobbystycznych praktyk rozwijaliśmy mini-platformę do wystawiania ogłoszeń. Jednym z wymagań była wyszukiwarka, dzięki której mozna wyszukiwać produkty: po tytule, slowach kluczowych, kategorii, cenie i lokalizacji. Zdecydowaliśmy się na elasticsearch, ponieważ wspiera wyszukiwanie pełnotekstowe i geograficzne.</p>\n<h3 id=\"setup\">Setup</h3>\n<p>Na potrzeby zabawy postawimy sobie 2 kontenery dockerowe z elasticem + kibaną. Zdefiniowaliśmy:</p>\n<ul>\n<li>1 kontener z elasticsearch w wersji 7.8.0</li>\n<li>1 kontener z kibaną w wersji 7.6.0</li>\n<li>2 woluminy, na których będą przechowywane dane</li>\n<li>sieć o nazwie elastic-network</li>\n</ul>\n<p>Wersje nie są najnowsze, ale akurat miałam te obrazy lokalnie na komputerze. Można w razie czego zmienić na nowszą.</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">version</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">2.2</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #8FBCBB\">services</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">es01</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">image</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">docker.elastic.co/elasticsearch/elasticsearch:7.8.0</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">environment</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">bootstrap.memory_lock=true</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">ES_JAVA_OPTS=-Xms512m -Xmx512m</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">discovery.type=single-node</span>\n<span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">volumes</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">data01:/usr/share/elasticsearch/data</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">ports</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">9200:9200</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">networks</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">elastic-network</span>\n<span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">kibana01</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">image</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">docker.elastic.co/kibana/kibana:7.6.0</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">container_name</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">kib01</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">ports</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">5601:5601</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">environment</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #8FBCBB\">ELASTICSEARCH_URL</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">http://es01:9200</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #8FBCBB\">ELASTICSEARCH_HOSTS</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">http://es01:9200</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">depends_on</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">es01</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">networks</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">     </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">elastic-network</span>\n<span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #8FBCBB\">volumes</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">data01</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">driver</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">local</span>\n<span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #8FBCBB\">networks</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">elastic-network</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">   </span><span style=\"color: #8FBCBB\">driver</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">bridge</span></code></pre>\n<p>Przeklejamy powyższy plik do docker-compose.yml i zapisujemy. Posiadamy już deklaratywny plik, na podstawie którego docker-compose utworzy wszystko za nas.\nWykonujemy polecenie (dla osób z słabszym internetem - może trochę potrwać, bo pobierają się obrazy):</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">docker-compose up</span></code></pre>\n<p>Sprawdzamy czy wszystko działa:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">docker ps</span></code></pre>\n<p>Powinny się nam pojawić 2 działajace kontenery. Jeśli tak, to fajnie. :)</p>\n<h3 id=\"model-danych\">Model danych</h3>\n<p>Zanim cokolwiek ciekawego zaczniemy robić, musimy zamodelować nasze dane. </p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">title</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">text</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">description</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">text</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">location</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">:\"geo_point\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">price</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">double</span><span style=\"color: #ECEFF4\">\"</span></code></pre>\n<p>Idziemy w maksymalne uproszczenie schematu. Myślę, że model jest dość czytelny. Id zostanie dodane automatycznie. Mamy title i description o typie text, location jest punktem (x,y), który można osadzić na mapie, price to cena - double. Tyle na teraz wystarczy.</p>\n<h3 id=\"mappingi--typy\">Mappingi &#x26; Typy</h3>\n<p>W Elasticu nasz “scheme” definiujemy za pomocą mappingów. Określamy w nich strukturę dokumentów (np offer ). W mappingach można również zawrzeć w nich dodatkowe techniczne ustawienia - ilość replik, timeouty. Dawniej w jednym indexie mozna było przechowywać wiele typów, co powodowało czasem dziwne błędy. Jednak w najnowszych wersjach elastica, jest jeden “typ” per index. Da się to ominąć, znajdziesz to w <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/removal-of-types.html#_custom_type_field.\" title=\"dokumentacji\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dokumentacji</a>.</p>\n<p>Zapisujemy poniższą składnię w pliku offer_mapping.json. Umożliwi to nam stworzenie indeksu. Wykorzystamy go za chwile. </p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">mappings</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">properties</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">type</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">text</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                   </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">type</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">text</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                   </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">type</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">geo_point</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                   </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">type</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">double</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>Wykonujemy komendę, tworząc tym samym nowy index.</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">curl -H </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Content-Type: application/json</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> -X PUT http://localhost:3000/offers --data </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">@offer_schema.json</span><span style=\"color: #ECEFF4\">\"</span></code></pre>\n<p>W dalszej części do wykonywania requestów będę już używać devtoolsów w kibanie, bo będzie czytelniej. Jeśli nie chcesz tego używać i wolisz CLI, z łatwością wykonasz requesty np. curlem, jak powyżej.</p>\n<h4 id=\"kibana-devtools\">Kibana Devtools</h4>\n<p><img src=\"/images/posts/elasticsearch-zapytania/elasticsearch-1.png\" alt=\"Tak wyglądają devtoolsy\" title=\"Tak wyglądają devtoolsy\"></p>\n<h3 id=\"feedowanie-danych\">Feedowanie danych</h3>\n<p>Poniżej mini-zbiór danych do sprawdzenia, jak to działa.</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">POST offers/_doc</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">              </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">skarpety rozmiar 36</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">              </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">kolorowe skarpetki w kropki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">              </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                 </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">40</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #D8DEE9FF\">                 </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-70</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">              </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">10.00</span>\n<span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">POST offers/_doc</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">szelki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">szelki w kolorze czarnym, rozmiar XS</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                 </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">50</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #D8DEE9FF\">                 </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-40</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">14.00</span>\n\n<span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">POST offers/_doc</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">muszka</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">czerwona, męska</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                 </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">50</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #D8DEE9FF\">                 </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-30</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">130.00</span>\n\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<h3 id=\"scenariusze-z-życia-wzięte\">Scenariusze z życia wzięte:</h3>\n<h4 id=\"użytkownik-wyszukuje-pełnotekstowo-po-tytule-oferty\">Użytkownik wyszukuje pełnotekstowo po tytule oferty:</h4>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">GET offers/_search</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">query</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">match</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">skarpetki</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>Odpowiedź z serwera, widzimy znaleziony rekord, ponieważ w tytule zawarte jest słowo \"skarpetki\":</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">took</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">timed_out</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">false</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_shards</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">successful</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">skipped</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">failed</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">value</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">relation</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">eq</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">max_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0.7389809</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">[</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_index</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">offers</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_type</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">_doc</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_id</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">QiyNanQB6SAY5Ir04SbI</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0.7389809</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_source</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">skarpety rozmiar 36</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">kolorowe skarpetki w kropki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">40</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-70</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">10.0</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">]</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<h4 id=\"użytkownik-w-filtrach-wybiera-zakres-cenowy\">Użytkownik w filtrach wybiera zakres cenowy</h4>\n<p>Ustalamy:</p>\n<ul>\n<li>gte (greater than or equal) - większe lub równe 10, </li>\n<li>lte (lower than or equal) - mniejsze lub równe 20</li>\n</ul>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">GET offers/_search</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">query</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">range</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">gte</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">10</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lte</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">20</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">boost</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2.0</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>Znalezione 2 oferty, z ceną większą niż 10 ale mniejszą niż 20.</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">took</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">timed_out</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">false</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_shards</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">successful</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">skipped</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">failed</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">value</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">relation</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">eq</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">max_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2.0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">[</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_index</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">offers</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_type</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">_doc</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_id</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">QiyNanQB6SAY5Ir04SbI</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2.0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_source</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">skarpety rozmiar 36</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">kolorowe skarpetki w kropki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">40</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-70</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">10.0</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_index</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">offers</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_type</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">_doc</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_id</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">RCyNanQB6SAY5Ir07CYY</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2.0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_source</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">szelki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">szelki w kolorze czarnym, rozmiar XS</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">50</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-40</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">14.0</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">]</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<h4 id=\"szukanie-po-lokalizacji\">Szukanie po lokalizacji:</h4>\n<p>Chcemy znaleźć oferty w promieniu 100km od miejscowości o współrzędnych [-70.001, 40.002]</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">GET offers/_search</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">query</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">bool</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">must</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">match_all</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{}</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">filter</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">geo_distance</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">distance</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">100km</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">[</span><span style=\"color: #B48EAD\">-70.001</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">40.002</span><span style=\"color: #ECEFF4\">]</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>Odpowiedź z serwera:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">took</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">timed_out</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">false</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_shards</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">successful</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">skipped</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">failed</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">value</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">relation</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">eq</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">max_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1.0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">[</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_index</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">offers</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_type</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">_doc</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_id</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">-SyVanQB6SAY5Ir0BSZs</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1.0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_source</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">skarpety rozmiar 36</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">kolorowe skarpetki w kropki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">40</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-70</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">10.0</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">]</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>Znalazło 1 rekord o współrzędnych [-70, 40].</p>\n<h4 id=\"wyszukiwanie-również-w-opisie\">Wyszukiwanie również w opisie</h4>\n<p>Mamy 1 rekord, który w tytule ma \"skarpety\" a w opisie \"skarpetki\". Chcemy go wyszukać po opisie. Ogólnie da się skonfigurować, żeby wyszukiwało pochodne słowa od skarpety, ale to może w innym poście :)</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">GET offers/_search</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">query</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">multi_match</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">query</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">skarpetki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">fields</span><span style=\"color: #ECEFF4\">\":</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">[</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">title</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">description</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">]</span><span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>No i mamy znalezione skarpetki.</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">took</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">timed_out</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">false</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_shards</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">successful</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">skipped</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">failed</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">total</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">value</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">relation</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">eq</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">max_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0.9808291</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">hits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">[</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_index</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">offers</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_type</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">_doc</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_id</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">-SyVanQB6SAY5Ir0BSZs</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_score</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0.9808291</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">_source</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">title</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">skarpety rozmiar 36</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">description</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">kolorowe skarpetki w kropki</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">location</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lat</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">40</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">lon</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">-70</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #8FBCBB\">price</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">10.0</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">]</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>To tyle na dziś. Jako czytelnik różnych blogów lubię, gdy jest dużo przykładów, więc też w takiej formie postanowiłam stworzyć wpis. Będę testować, czy przyjemniej mi się tak pisze.</p>\n","excerpt":"Elasticsearch to zaawansowany silnik wyszukiwań a jednocześnie baza danych pozwalająca na przechowywanie różnych typów danych. Wykorzystywana jest głównie przy komercyjnych wyszukiwarkach oraz przy","description":"Elasticsearch - nie tylko logi","cover":"/images/posts/elasticsearch-zapytania/searching.jpg","timeToRead":5,"author":{"id":"Julia","title":"Julia","path":"/author/Julia/"}}},{"node":{"id":"01b673a54fe138ff910e48e04c7ae551","title":"Czym jest Big Data?","datetime":"2018-05-31 17:54:43","path":"/czym-jest-big-data/","content":"<p>Łączenie z internetem nieuchronnie prowadzi nas do <strong>udostępniania i dostarczania</strong> swoich danych różnym podmiotom. Począwszy od zapisania naszej aktywności w logach naszego dostawcy usług internetowych (ISP), którą mogą badać organy ścigania, skończywszy na różnorodnych portalach społecznościowych i ecommerce, które odwiedzamy. </p>\n<p>Dane zostawiamy jak <strong>odciski palców</strong>, gdy używamy dany przedmiot. Przy umiejętnej analizie, przy wykorzystaniu wiedzy i narzędzi, można zbadać wiele informacji na temat użytkownika.</p>\n<p>Aby przybliżyć skalę gromadzenia danych, można przybliżyć statystyki, które są zamieszczone na infografice (rysunek 1). Na chwilę obecną przyrost danych przyjmuje kształt <strong>funkcji wykładniczej</strong>. Analitycy nie przewidują załamania tej tendencji. <strong>Ponad 90%</strong> ogółu istniejących danych zostało zgromadzone w przeciągu 2 lat\n<a href=\"https://www.ibm.com/analytics/hadoop/big-data-analytics\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[link do raportu IBM]</a>. </p>\n<p>W 2012 r. Prognozowano <em>podwojenie danych co dwa lata</em> do roku 2020. W 2020 r. Ilość wytworzonych danych cyfrowych przekroczy 40 zettabajtów, co odpowiada 5 200 gigabajtom na każdego mężczyznę, kobietę i dziecko na ziemi. </p>\n<p><img src=\"/images/posts/big-data/1.png\"></p>\n<p>Jak przechowywać tak duże zbiory danych? Do czego się mogą przydać? Czy posiadanie ich może być niebezpieczne? Opracowaniem tych problemów zajmują się badania nad <strong>Big Data</strong>. Ta szeroka dziedzina obejmuje wiele mniejszych sub dziedzin, jak na przykład <strong>uczenie maszynowe, technologie blockchain</strong> czy <strong>rozproszone bazy danych</strong>. W tym krótkim referacie jednak nie starczy miejsca na dokładne opracowanie tych zagadnień, zatem zostaną one wyjaśnione zwięźle.</p>\n<h3 id=\"historia-big-data\">Historia Big Data</h3>\n<p>Jednym z najstarszych <strong>dużych zbiorów danych</strong> była <strong>biblioteka</strong> asyryjskiego króla Assurbanipala. Została ona odkryta w dwóch fazach w czasie prac wykopaliskowych prowadzonych od 1849 roku przez Austena H. Layarda na terenach starożytnej Mezopotamii na wzgórzu Kujundżyk, które kryło w sobie pozostałości pałaców: Sennacheryba i Assurbanipala. </p>\n<p>Jej powstanie szacuje się na VII w p.n.e. Nie znano wtedy papieru, przez co wszystkie dane zostały spisane na <strong>glinianych tabliczkach</strong>. Spisano na nich ówczesne <em>przepisy</em>, <em>ewidencję ludności</em> a także około <em>5000 dzieł literackich</em> religijnych i naukowych z zakresu prawa, historii, astronomii, matematyki. Kolekcja zawiera łącznie ok. 20 000 glinianych tabliczek z obydwu pałaców.</p>\n<p>Biblioteka Assurbanipala jest relatywnie małym zbiorem danych w porównaniu do dzisiejszych zasobów baz danych. Nie należy się dziwić - bariera technologiczna między ówczesnymi czasami a XXI wiekiem jest ogromna. Dawne niezautomatyzowane metody gromadzenia informacji sprawiały, że praca w administracji była trudna i żmudna. Pomimo tego uznałam, że należało o niej wspomnieć, aby zwrócić uwagę na fakt, iż nie jest to nowy termin, a zjawisko istniejące od początku cywilizacji.</p>\n<p>Od czasów Assurbanipala minęło wiele wieków, podczas których rozwijano wiedzę o otaczającym nas świecie. Każda dziedzina ma tyle powiązań z drugą, że nie sposób rozpisać się o absolutnie całej historii danej nauki.\nNależałoby w takiej sytuacji cofnąć się do czasów, gdy odkryto elektryczność, przejść przez dynamiczną historię rozwoju komputerów i ich wydajności, by dopiero móc rozważać nad pełną historią big data. Są jednak takie fakty, które są na tyle ważne, że nie powinno się ich pominąć. </p>\n<p>Istotnym przełomem w cyfryzacji danych było <strong>wynalezienie</strong> w roku 1928 przez <strong>Fritza Pfleumera</strong>, niemiecko-austriackiego inżyniera, <strong>metody przechowywania danych na taśmach magnetycznych</strong>. Zasady, które opracował, są nadal używane, a większość danych cyfrowych jest przechowywana tą właśnie metodą na dyskach twardych komputera. </p>\n<p>W 1956 przeciętny dysk miał <strong>pojemność 5MB</strong>. Obecnie pamięci masowe do wykorzystania w serwerach posiadają pojemność <strong>do 14TB</strong>. Duży przyrost powierzchni dysków w przeciągu 60 lat dał szansę na <strong>lepsze i optymalniejsze</strong> gromadzenie danych.</p>\n<p><img src=\"/images/posts/big-data/2.jpg\"></p>\n<p>W 1997 Michael Cox i David Ellsworth opublikowane <em>\"Application-Controlled Demand Paging for Out-of-Core Visualization\"</em>. Jest to pierwszy artykuł wykorzystujący termin \"big data\". Praca rozpoczyna się od stwierdzenia: </p>\n<blockquote>\n<p>\"Wizualizacja stanowi interesujące wyzwanie dla systemów komputerowych: zbiory danych są na ogół dość duże, obciążając pojemność pamięci głównej, dysku lokalnego, a nawet dysku zdalnego. Nazywamy to problemem dużych zbiorów danych. Gdy zestawy danych nie mieszczą się w pamięci głównej (w rdzeniu) lub gdy nie mieszczą się nawet na dysku lokalnym, najczęstszym rozwiązaniem jest zdobycie większej ilości zasobów. \" </p>\n</blockquote>\n<p>W 1998 roku została założona spółka Google Inc. przez dwóch doktorantów Uniwersytetu Stanforda, Amerykanina Larry'ego Page'a i Rosjanina Siergieja Brina. Opracowali oni nowatorską <strong>metodę analizy powiązań hipertekstowych</strong> – algorytm <strong>BackRub</strong>, potem przemianowany na <strong>PageRank</strong> – którą wykorzystali w swoim prototypie wyszukiwarki internetowej. </p>\n<p>Korzystając z Big Data, korporacja musi rozprawiać się z bilionami danych znajdujących się w sieci i przeanalizować miliardy zachowań ludzi w internecie, aby dokładnie wiedzieć gdzie znaleźć odpowiedzi na zapytania użytkowników. Obecnie bazy danych Google stanowią ponad 1 milion petabajtów danych. Analizują także ponad <strong>24 petabajty danych dziennie</strong>, co stanowi tysiąc razy więcej niż wszystkie materiały wydrukowane kiedykolwiek w Bibliotece Kongresu Stanów Zjednoczonych.  </p>\n<p>Łatwo jest uwierzyć, że istnienie dużych zbiorów danych nie jest bardziej odległe niż kilka ostatnich lat, a analiza danych stała się kluczowa dla przedsiębiorstw dopiero w ostatnich kilku dekadach. To prawda, że ​​stanowisko biznesowe w zakresie analizy danych uległo przesunięciu w czasie; Im bardziej dostępne są dane, tym ważniejsze dla firm jest znalezienie sposobu konwersji danych na <strong>wzbogacone źródła informacji biznesowych</strong>, dzięki czemu zyskują przewagę nad konkurencją. Wiele firm trafnie wykorzystuje dane jako <strong>aktywa biznesowe</strong>, ponieważ są integralną częścią prowadzenia działalności gospodarczej.</p>\n<h3 id=\"czym-są-zatem-big-data\">Czym są zatem Big Data?</h3>\n<p>Jedna z pierwszych definicji Big Data została wprowadzona przez M. Cox i D. Ellswortha w 1997 roku. Autorzy traktują Big Data jako duże dane do analizowania, których liczbę należy maksymalizować w celu wydobycia wartości informacyjnych. Inną propozycję definicji wysunął analityk pracujący dla Gartner w 2001 r., ówcześnie META Group (firmy analityczno-doradczej specjalizującej się w technologiach informacyjnych). Oparł ją na <strong>koncepcji trzech atrybutów w modelu „3V”.</strong></p>\n<p>Big Data charakteryzują atrybuty: <strong>objętość</strong> (volume), <strong>różnorodność</strong> (variety), <strong>szybkość przetwarzania</strong> (velocity) [Doug 2001]. Następnie w roku 2012 firma Gartner wprowadziła dodatkowe dwa wymiary odnoszące się do dużych danych: <strong>zmienność</strong> (variability) i <strong>złożoność</strong> (complexity).</p>\n<p><img src=\"/images/posts/big-data/3.jpg\"></p>\n<p>Big Data należy rozumieć jako techniki łączące rozwiązania z wielu obszarów charakteryzujących dane.</p>\n<ul>\n<li><strong>Szybkość</strong> – dane napływające szybko, strumieniowo, które w związku z procesami<br>\nbiznesowymi wymagają dodatkowej mocy obliczeniowej do ich analizy w<br>\nczasie rzeczywistym.</li>\n<li><strong>Różnorodność</strong> – dane pochodzą z wielu źródeł i często występują w różnych formatach i są zapisywane za pomocą różnych modeli oraz wyrażane w dowolnej formie, np.: liczbowo, tekst, obrazowo, dźwiękowo, oraz generowane w różny sposób.</li>\n<li><strong>Zmienność</strong> – dane, których natężenie jest zmienne w czasie, a przepływy danych<br>\npodlegają okresowym cyklom i trendom, a także szczytom, co związane jest<br>\nrównież z dynamiką procesów i zmian gospodarczych czy politycznych.</li>\n<li><strong>Złożoność</strong> – złożoność danych jest ściśle związana z różnorodnością (semi-structured, „quazi” structured, unstructured), które należy zintegrować w celu odkrycia nieznanych relacji, powiązań i hierarchii. Do danych strukturalnych należą: numery telefonów, pesel, numer karty kredytowej. Dane o mieszanej strukturze to np. pliki XML, e-mail, Elektroniczna Wymiana Danych (Electronic Data Interchange, EDI). Natomiast dane niestrukturalne to: dokumenty, pliki wideo i zdjęcia.</li>\n<li><strong>Wartość</strong> – unikatowa wartość informacyjna ukryta w dużych i złożonych strukturach danych, dająca możliwość wyciągania nowych wniosków, które następnie przyczyniają się do wzrostu efektywności działania organizacji na różnych płaszczyznach.</li>\n</ul>\n<h3 id=\"użyteczność-i-wykorzystanie-big-data\">Użyteczność i wykorzystanie Big Data</h3>\n<p>S. Parise i in. określają cztery główne kierunki wykorzystania analiz dużych zbiorów danych:</p>\n<ul>\n<li>Analizy społeczne (social analysis)</li>\n<li>Podejmowanie decyzji (decision science).</li>\n<li>Podnoszenie efektywności i skuteczności (performance management).</li>\n<li>Eksploracja danych (data exploration).</li>\n</ul>\n<p>Big Data pozwala niemal natychmiast odpowiedzieć na skomplikowane problemy biznesowe oraz naukowe. Dane mogą być nie tylko naukową wiedzą, ale także informacją biznesową, dzięki której można zyskać wiele wymiernych korzyści związanych z obniżeniem kosztów działalności, organizacji oraz zarządzania. </p>\n<p>Duże strumienie kapitału, skierowane w sektor big data, mogą pozwolić na uzyskanie sukcesu w biznesie oraz osiągnięć naukowych. Jest to niezwykły wymiar, który umożliwia dokonać nowych, nieznanych dotąd operacji. Dostarcza on ogromne możliwości informacyjne. </p>\n<p>Prawidłowo zinterpretowane dane przez specjalistów, mogą wpłynąć na <strong>optymalizację wielu procesów w gospodarce, w polityce</strong> czy <strong>ochronie środowiska</strong>. Ilość różnych dziedzin, w których można wykorzystać big data, jest ogromna. Nie należy jednak do każdego wykorzystania podchodzić jednakowo, a wypracować najbardziej optymalny system zarządzania dla danej branży.</p>\n<p>Trudno zliczyć wszystkie możliwe sektory, w których można wykorzystać naukę o danych, jednak z pewnością można wymienić główne obszary jak na przykład: usługi bankowe, finanse, edukacja, logistyka w transporcie, modelowanie środowiska, oszczędzanie zasobów.</p>\n<p><img src=\"/images/posts/big-data/4.jpg\"></p>\n<h3 id=\"zarządzanie-big-data-i-narzędzia\">Zarządzanie Big Data i narzędzia</h3>\n<p>Zarządzanie dużymi danymi to szeroka koncepcja, która obejmuje zasady, procedury i technologie wykorzystywane do gromadzenia, przechowywania, zarządzania, organizacji, administrowania i dostarczania dużych repozytoriów danych. Może obejmować oczyszczanie danych, migrację, integrację i przygotowanie do użycia w raportach i analizach.<br>\nBig data jest ściśle związane z ideą zarządzania cyklem życia danych (DLM). Jest to szeroka koncepcja określania, które informacje powinny być przechowywane w bazach danych organizacji, a także kiedy dane można bezpiecznie usunąć.</p>\n<p><img src=\"/images/posts/big-data/5.jpg\"></p>\n<p>Nad zespołem data scientists spoczywa ogromna odpowiedzialność wynikająca z dbania o bezpieczeństwo danych, umiejętnego zarządzania. Istotnym jest posiadanie <strong>szerokiej wiedzy</strong> z zakresu ekonomii, <strong>matematyki</strong>, <strong>statystyki</strong> oraz informatyki, a w szczególności <strong>programowania</strong> i <strong>zarządzania bazami danych</strong>. Konieczna jest także umiejętność korzystania z wielu narzędzi przygotowanych do analityki danych. Część z nich jest dostępna jako wolne oprogramowanie, z którego może skorzystać każdy zainteresowany. Jest to zaletą dla szkół oraz samouków, którzy chcą się rozwijać w zakresie big data. Także wiele popularnych przedsiębiorstw, jak na przykład Adobe czy LinkedIn, wykorzystuje <strong>Apache Hadoop</strong>, który jest opensource. </p>\n<p>Istnieją także usługi komercyjne, które udostępniają całe wachlarze usług do zarządzania danymi. Należą do nich na przykład Azure czy AWS.</p>\n<p><img src=\"/images/posts/big-data/6.jpeg\"></p>\n<p><strong>Microsoft Azure</strong> to ciągle rozwijający się zestaw usług w chmurze, który ułatwia sprostanie wyzwaniom biznesowym. Zapewnia swobodę tworzenia i wdrażania aplikacji oraz zarządzania nimi w ogromnej, globalnej sieci przy użyciu wybranych narzędzi i struktur.</p>\n<p><strong>Amazon Web Services</strong> (AWS) to bezpieczna platforma usług w chmurze oferująca moc obliczeniową, przechowywanie baz danych, dostarczanie treści i inne funkcje, które pomagają firmom skalować się i rozwijać. Rozwiązania oparte na chmurze obliczeniowej AWS pozwalają tworzyć zaawansowane aplikacje o zwiększonej elastyczności, skalowalności i niezawodności.</p>\n<p><img src=\"/images/posts/big-data/7.png\"></p>\n<p>Jedną z ciekawych alternatyw dla komercyjnych platform zarządzania danymi jest <strong>Hadoop</strong>, otwarte oprogramowanie stworzone przez fundację Apache, która stworzyła m.in. także narzędzia <strong>Apache Spark</strong> (framework do obliczeń rozproszonych), <strong>Apache Storm</strong> (przetwarzanie strumieniowe), <strong>Kafka</strong> (message broker). Dlaczego warto zwrócić uwagę na Hadoop?</p>\n<ul>\n<li>Zdolność do szybkiego przechowywania i przetwarzania ogromnych ilości danych.</li>\n<li>Zoptymalizowana moc obliczeniowa - model obliczeń rozproszonych Hadoop szybko przetwarza duże ilości danych.</li>\n<li>Odporność na awarie. Jeśli węzeł ulegnie awarii, zadania są automatycznie przekierowywane do innych węzłów, aby upewnić się, że przetwarzanie rozproszone nie zakończy się niepowodzeniem. Wiele kopii wszystkich danych jest zapisywane automatycznie.</li>\n<li>Elastyczność. W przeciwieństwie do tradycyjnych relacyjnych baz danych, nie trzeba przygotowywać danych przed ich zapisaniem.</li>\n<li>Platforma open-source jest darmowa i wykorzystuje sprzęt do przechowywania dużych ilości danych.</li>\n<li>Skalowalność. Można łatwo rozbudować swój system, aby obsługiwać więcej danych przez proste dodawanie węzłów.</li>\n</ul>\n<p><img src=\"/images/posts/big-data/8.png\"></p>\n<p>Do wizualizacji danych przyjemnym i łatwym w obsłudze oprogramowaniem jest produkt Microsoftu - <strong>PowerBI</strong>. Pozwala on przechwytywać dane z baz danych (np mysql, XML, mongoDB) i przedstawiać je w formie kolorowych wykresów.</p>\n<p><img src=\"/images/posts/big-data/9.png\"></p>\n<p>Bibliografia:</p>\n<p><a href=\"https://www.ibm.com/analytics/hadoop/big-data-analytics\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.ibm.com/analytics/hadoop/big-data-analytics</a></p>\n<p><a href=\"http://www.ce.uw.edu.pl/pliki/pw/3-2017_grabowska.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://www.ce.uw.edu.pl/pliki/pw/3-2017_grabowska.pdf</a></p>\n<p><a href=\"http://www.blog.intracare.pl/narzedzia-analityczne-big-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://www.blog.intracare.pl/narzedzia-analityczne-big-data/</a></p>\n<p><a href=\"https://www.evl.uic.edu/cavern/rg/20040525_renambot/Viz/parallel_volviz/paging_outofcore_viz97.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.evl.uic.edu/cavern/rg/20040525_renambot/Viz/parallel_volviz/paging_outofcore_viz97.pdf</a></p>\n","excerpt":"Łączenie z internetem nieuchronnie prowadzi nas do udostępniania i dostarczania swoich danych różnym podmiotom. Począwszy od zapisania naszej aktywności w logach naszego dostawcy usług internetowych","description":"Post, który napisałam jako zadanie domowe z sieci komputerowych.","cover":"/images/posts/big-data/3.jpg","timeToRead":9,"author":{"id":"Julia","title":"Julia","path":"/author/Julia/"}}}]}}},"context":{}}