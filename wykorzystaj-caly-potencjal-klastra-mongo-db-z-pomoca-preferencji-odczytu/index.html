<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" class="h-full" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D,%22class%22:%7B%22ssr%22:%22h-full%22%7D%7D">
  <head>
    <title>Autodydaktycznie. Blog o technologiach webowych i IT | Julia Glaszka</title><meta name="gridsome:hash" content="cde3975b2cc1a3efa8eb321a9087e9a1a3505c84"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="theme-color" content="#261447"><meta data-vue-tag="ssr" name="msapplication-navbutton-color" content="#261447"><meta data-vue-tag="ssr" name="apple-mobile-web-app-status-bar-style" content="#261447"><meta data-vue-tag="ssr" name="viewport" content="width=device-width"><meta data-vue-tag="ssr" data-key="description" name="description" content="Blog o moich samodzielnych zmaganiach z nauką z różnych dziedzin IT. "><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.34768914d4a101067dd64a8f857ab22c.png"><link rel="preload" href="/assets/css/0.styles.e8ecfe4b.css" as="style"><link rel="preload" href="/assets/js/app.b3cdbf32.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.c6413ee8.js" as="script"><link rel="prefetch" href="/assets/js/8.d0377bf1.js"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.48a58ab3.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.dffb8746.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue~page--src--templates--tag-vue.f05de6a7.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.128a08df.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--index-vue~page--src--templates--post-vue~page--src--templates--tag-vue.42fdade6.js"><link rel="stylesheet" href="/assets/css/0.styles.e8ecfe4b.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body class="antialiased font-serif" data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22antialiased%20font-serif%22%7D%7D">
    <div data-server-rendered="true" id="app" class="bg-white"><nav class="navbar is-transparent"><div class="navbar-brand"><a href="/" class="navbar-item has-text-weight-semibold has-text-black-bis">✨ Julia Glaszka</a><div class="navbar-burger"><span></span><span></span><span></span></div></div><div class="navbar-menu"><div class="navbar-end"><a href="/#about" class="navbar-item">
        O mnie
      </a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link">
          Tematy
        </a><div class="navbar-dropdown is-boxed"><a href="/tag/java/" class="navbar-item">
            #java
          </a><a href="/tag/database/" class="navbar-item">
            #database
          </a><a href="/tag/design/" class="navbar-item">
            #design
          </a><a href="/tag/inżynieria/" class="navbar-item">
            #inżynieria
          </a><a href="/tag/soft%20skills/" class="navbar-item">
            #soft_skills
          </a></div></div><a href="/#posts" class="navbar-item">
        Najnowsze wpisy
      </a><div class="navbar-item"><a href="/#contact" class="button is-rounded">
          Kontakt
        </a></div></div></div></nav><header class="is-halfheight" data-v-b95eca5a><section class="section" style="height:100%;background-image:linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url(/images/posts/mongodb-read-preferences/route.jpg);background-position:center;background-size:cover;" data-v-b95eca5a><div class="container" data-v-b95eca5a><div data-v-b95eca5a><h5 class="has-text-6 is-uppercase has-text-white" data-v-b95eca5a>
              3 min czytania
            </h5><h1 class="title is-size-2 p-t-md has-text-white" data-v-b95eca5a>
              Wykorzystaj cały potencjał klastra MongoDB z pomocą preferencji odczytu
            </h1><h2 class="subtitle p-t-md has-text-white" data-v-b95eca5a><span data-v-b95eca5a><a href="/undefined/" class="has-text-white">
                  Julia Glaszka</a> •
              </span><time datetime="2021-11-15 18:37:24" class="capitalize" data-v-b95eca5a>15 listopada, 2021</time></h2><nav class="container"><a href="/" class="has-text-white active">
      ← Powrót
    </a></nav></div></div></section></header><div class="container"><section class="section"><div class="columns mt-5"><div class="column is-three-quarters"><div class="container"><div class="is-three-fifths-tablet post"><!----><div class="content has-text-justified-desktop"><h1 id=""></h1>
<p>Typowy produkcyjny klaster jest zbudowany z co najmniej jednego ReplicaSetu. To oznacza, że posiadamy co najmniej jeden węzeł Primary (realizujący zapisy i odczyty) i kilka Secondary (tylko do odczytu). Domyślne ustawienia konfiguracji sterowników kierują ruch wyłącznie do Primary, rezygnując z używania pozostałych hostów. To oznacza, że obciążony jest tylko jeden node, a reszta pozostaje bierna - zasoby pod względem load-balancingu są marnowane. W przypadku awarii Mastera tracimy też możliwość odczytów, które mogłyby być nadal realizowane przez Secondary.</p>
<p>Zatem w jaki sposób można wymusić kierowanie ruchu do innych hostów niż Primary? Z pomocą przychodzą nam preferencje odczytu - tzw. <code>ReadPreference</code>. Posiada on różne tryby, pozwalające na wybranie algorytmu poszukiwania hosta, do którego wyślemy query.</p>
<h2 id="konfiguracja-preferencji-odczytu-w-driverze">Konfiguracja preferencji odczytu w driverze</h2>
<p>Ustawienia <code>ReadPreference</code> można zdefiniować w kilku miejscach:</p>
<ul>
<li>na poziomie klastra:</li>
</ul>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #8FBCBB">MongoClient</span><span style="color: #D8DEE9FF"> mongoClient </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">MongoClients</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">create</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">MongoClientSettings</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">builder</span><span style="color: #ECEFF4">()</span><span style="color: #D8DEE9FF">  </span>
<span style="color: #D8DEE9FF">.</span><span style="color: #88C0D0">hosts</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">listOfHostsUrls</span><span style="color: #ECEFF4">)</span>
<span style="color: #D8DEE9FF">.</span><span style="color: #88C0D0">readPreference</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">ReadPreference</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">secondary</span><span style="color: #ECEFF4">())</span><span style="color: #D8DEE9FF">  </span>
<span style="color: #D8DEE9FF">.</span><span style="color: #88C0D0">build</span><span style="color: #ECEFF4">())</span><span style="color: #81A1C1">;</span></code></pre>
<ul>
<li>na poziomie bazy danych</li>
</ul>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #8FBCBB">MongoDatabase</span><span style="color: #D8DEE9FF"> database </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> mongoClient</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">getDatabase</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">someDatabase</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">  </span>
<span style="color: #D8DEE9FF">.</span><span style="color: #88C0D0">withReadPreference</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">ReadPreference</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">secondary</span><span style="color: #ECEFF4">())</span><span style="color: #81A1C1">;</span></code></pre>
<ul>
<li>na poziomie kolekcji</li>
</ul>
<pre class="shiki" style="background-color: #2e3440"><code><span style="color: #8FBCBB">MongoCollection&lt;Document&gt;</span><span style="color: #D8DEE9FF"> collection </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> database</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">getCollection</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">videos</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">  </span>
<span style="color: #D8DEE9FF">.</span><span style="color: #88C0D0">withReadPreference</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">ReadPreference</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">secondary</span><span style="color: #ECEFF4">())</span><span style="color: #81A1C1">;</span></code></pre>
<p>Podane ustawienia mogą zmieniać działanie usługi, jeśli na przykład posiada na klastrze kilka różnych baz danych z różnymi kolekcjami. Może być tak, że nie dla wszystkich kolekcji można sobie pozwolić na odczyt z Secondary - np. gdy potrzebujemy wyższy poziom consistency.</p>
<h2 id="tryby-odczytu">Tryby odczytu</h2>
<h3 id="primary">primary</h3>
<p>Domyślny dla wielu driverów. Kieruje ruch wyłącznie do hosta typu Primary, co może być znaczącą barierą w skalowaniu usługi pod kątem odczytów.</p>
<h3 id="primarypreferred">primaryPreferred</h3>
<p>W tej preferencji w głównej mierze odczytujemy z hosta Primary, ale w przypadku gdy będzie niedostępny to odczyty zostaną przekierowana do innych replik typu Secondary.</p>
<h3 id="secondary">secondary</h3>
<p>Wszystkie odczyty są kierowane do Secondary.</p>
<h3 id="secondarypreferred">secondaryPreferred</h3>
<p>W większości przypadków odczytujemy z Secondary, ale przy awarii wszystkich hostów ruch może zostać przekierowany do Primary.</p>
<h3 id="nearest">nearest</h3>
<p>Driver selekcjonuje zdrowe hosty z odpowiednio krótkim czasem odpowiedzi, tak by odpowiedziały maksymalnie szybko - np w ramach jednego datacenter. Następnie losowo wybierany jest jeden host, który zrealizuje żądanie. Nie jest uwzględniane czy node jest Primary czy Secondary.</p>
<h2 id="jaki-tryb-odczytu-wybrać">Jaki tryb odczytu wybrać?</h2>
<p>W przypadku usługi typu heavy read z eventual consistency najbardziej optymalne będzie odczytywanie z preferencjami: <code>nearest</code>, <code>secondaryPreferred</code> lub <code>secondary</code>. Wybór konkretnej preferencji zależałby w tym przypadku od ilości zapisów oraz posiadanych hostów i zasobów. Jeśli usługa bardzo dużo zapisuje i Primary jest już dostatecznie obciążony, można rozważyć unikanie dociążania Primary poprzez preferencję <code>secondary</code> lub <code>secondaryPreferred</code>.</p>
<p>Ostateczny wybór między pozostałymi dwoma typami odczytów może rozstrzygnąć to - czy bardziej zależy nam na stabilności odczytów czy zapisów. SecondaryPreferred dostarcza n+1 hostów, natomiast samo secondary tylko n (bo nie uwzględnia Primary).</p>
<p>W sytuacji niespodziewanie większego ruchu warto mieć więcej dostępnych hostów niż mniej, ale analizując z drugiej strony - ten jeden dodatkowy host to Primary, jeśli zostanie obciążony to doprowadzi to również do niestabilności zapisów. Jeśli usługa nie posiada mechanizmów ponowień takich jak klienci z ponowieniami lub message queue, to dane mogą zostać niezapisane, co skłaniałoby do użycia preferencji secondary - wtedy awaria dotyczyłaby tylko odczytów.</p>
<h2 id="po-wdrożeniu">Po wdrożeniu</h2>
<p>Po wdrożeniu nowego typu preferencji warto mieć wgląd w metryki:</p>
<ul>
<li>czasów odpowiedzi usługi</li>
<li>czasów odpowiedzi bazy danych do usługi</li>
<li>load, zajętość ramu, ilość rps do kolekcji, obciążenie sieciowe klastra mongo</li>
</ul>
<h2 id="podsumowanie">Podsumowanie</h2>
<p>Jak widać, każde takie ustawienie trzeba samodzielnie przeanalizować, uwzględniając swoje własne wymagania względem stabilności. Wybranie konkretnej preferencji odczytu może mieć dalekosiężne skutki, dlatego przed wyborem zawsze warto się dłużej zastanowić i przeanalizować słabe punkty konkretnego rozwiązania. Polecam również zapoznać się z <a href="https://docs.mongodb.com/manual/core/read-preference/" target="_blank" rel="nofollow noopener noreferrer">oficjalną dokumentacją</a>.</p>
</div></div></div></div><div class="column is-one-quarter"><section class="sidebar"><div class="block"><div class="has-text-centered"><div class="block sidebar-author-info"><figure class="image is-128x128 is-inline-block"><img alt="Julia Glaszka" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 353 366' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-4af56300a7f407cb994a9baf48319f8e'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-4af56300a7f407cb994a9baf48319f8e)' width='353' height='366' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAABCCAIAAABow0eCAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAWP0lEQVRo3q3a%2bdtX0xoG8P1vcJnneZa5zDIPIRJCGYpKjiHznAgpdWQshDJkCDlUxgwRZYqTWUWmkLmj83n3rd2%2bvu/7fV3Xuc76YV/7u4e1nvt57udez1r7W3z77bdLyvafsi1Z2nL%2b9ddf33///TNnzvTzz7ItadIWL178yy%2b//PTTT175/PPP58%2bf/8EHH7zzzjufffbZF198kdeX/D9a%2bvlzaSsME1sbAOS5n3/%2b%2bcknn3z77bcXLVrUPgZ3f/zxx6%2b%2b%2bgoAJ5AsWLDg32WbNWtW1X81Svvu%2bFsMMcaxeOWVV1jZTo8ff/zx%2b%2b%2b/P2/evN9//73C3U6POX733XcwO3LQRx99VAGonvnfAHiXX7BmGYCXXnrJMO28gxi8OHv2bH5NF20OXDcLVBRauHChi5CLSThWjVpH0poezVzuRG8vv/xyaP8XgBkzZnz44Yd//PFHM5uc4DQaeJlT24xVZVZeYes333zDL07mzJkTB%2bWtCufislVdtR%2bN3PXu008//eKLL7J2WQ688cYbHGwMP3KjNe7ffvsNgMmTJ%2bNSA4AGSlTnP/zwA%2bbMnTvXeM8884zcEECeMxBsghPrE5Z6btS7zd1AddFb48aN4%2b6YZAh9Fq6KuJx76623Pvnkk2boPfDcc8899thjGFWXglgMuURKkjiSnalTp95yyy233nrrmDFj7r77bm4iR6%2b//vq/yuYuZQvHKgytvVAnm/brr79OmzYtbxmOg3RSxEqjikNY3gwD0PjHjnpMHXmCXAIPpB48QBjYffXVV48aNerxxx%2bnY7zjGddZP7Js48ePF1K0rCdDDK2oVflOt875TkipAiLwyKeffvree%2b8VFUSvcWSC1RpA%2bvKA7uqS4pwsSHEk%2bfLLL3mFoY8%2b%2buiIESOuuOKKCRMmvPbaa4jL9EmTJiUgN9544znnnDNkyBA/wQglqhSv/B23ZlZBQkYbxQmPIAJH8BRjiooMAdCOGtRdVScPADSHM3DM0aTB7muvvfayyy4zDN8/8sgjABh7%2bPDhl1566eWXX37RRRf179/fiVDccccdlDoY6kNLmCeeeALsiRMnDhs27Oabb3744Yd1ziPBwC%2biUVSCE/fjliQDvZkMJ75VrD0vv1999dV77rmHiTTHybnnnsvHF198sWGonLn8qaeeMjxGXXLJJaeffvp555136qmnnnTSSUCCKklwgwFYjpBcPn369AcffPDOO%2b/0yoiyXX/99SL2XNlwErDEoahnpHihMqGoC0KbwlopQxz8wAMPcCTfoATXnnLKKWeffTYHuw4VO/je8FddddX555/ft2/fE088EYyePXs6h%2bG6667zIu4JhVTk%2bPvuuw8P7733Xr4fVzYgkzZTpkxhNwwe45ci5Pm0bBzfzPQGxYz1XMXu22%2b/HRM4ns8uvPBCJmKIDOazhx56CHn4fujQochzxhlnsBi8Y4455uSTT3bs1q3bWWed5RZDdcU%2bZnB/yMNusiGGjPaT0dKAEDlxhfXPPvtsUfEY%2bqqwawagnmESyACcavhBgwYNLxs%2bMF3ER5fNMEJKMcDj6T59%2bnTt2vXII4/s16/fcccdB8B%2b%2b%2b137LHH4lvy4a677hIB%2bYrf3A985lCQGE2FWfjmm28%2bXTZa/PzzzxdV%2buOPN5spacP84twMNXjwYC7H%2bAsuuIDmEH6OFGvmsh4N5AatwA3DY7MIHHbYYYzu3r17jx49ANhnn33233//AQMGRJc8w1ZqJgIyh32MJvbqHcExvVC5F154gV9kAvc7L6pZXTryVuqWdmqSWC/RyYI0PbtsaHDTTTfxH9KTIKQnl/hjYNZn/sIQgWL0nnvuyWjkOeqoo5x36tQJntNOO40XrrnmmrFjxzLOu8jDaCnkdc4mOJRah5gDANN5sCUCmTsjQSa51BTtuD/8QUTuZ/c/yiYILOZ17ufFG264QcrCw/H8ZEgxcR1PMKdz58577LEHDIcffrhodOzYce%2b995YY%2bsFGnOQaprMPEgMhEmqwTSh0qDd43PIAkEXkPyyiZaaVZoVu3O/4/fffowfycBsxQWgDU5LonRxwLoPZAQPTOdXkhV00tHfv3szdbbfd%2bH7fffcFY5dddnHieoikK8F8tGwczHo8NL04p5sibBIAINbLrmU5wETuR9l2AMT9oskgDqOYVMWRyPCcIx47AcA5iz3GGgFxRcTIP0MPOOAARgfA7rvvvuOOO%2b66665yo0/ZEIkYELQoKQoxVBhNZ9KaR6i2OKCQ6y21kLmjIr1Q8G47i4k0Yb3yyiux%2bfjjj%2bd%2bQTAk%2bjI3J0wHwDnrZTbyAIA/AJi8Dj74YHYzGpEct99%2b%2b6233nqHHXZIZvMLL8hgucTZ4RL3O3cFKlewCDD50AKAO1Vpf1uRZ/IKf7CCKQSEIIoAbeFdbg7R/1m2uD8Ukg8YJTK8y8ddunTxriBst912OXbo0GGTTTaRGzLkhBNOILgynrk4w1YW64RAEzpzGTzcD4CjKaKgm3jfrHZoKCLCH97F15133vnoo49GiSgg9vO3IySOAEhrDoMBEgAEbeDAgSKALQDstNNO7N5mm2343hGATTfd9KiyeUwnggAAwSGpPHJB2fQWu6ntX0mcskmap9Bvp4JIAoBODc2jPAcAFrHJkNwDBv5ct7TBIyBymu/dFTS1A/LQTXkcAMHgyrbbbrvGGmsAhkUUyVucLQdEAH8YLQjmTbmhTz%2bVMDK4hUJhDpEyfbTGUF%2bnawKlI/IvARCXt8yjOC0aUlN9huhDysYCYFDLwziG35Rnyy235GZH1HfcfPPN85P1xHSttdbyk7aqlLBIhaIGMeMyFwbKw99kOppBmt59913F6bIFTWp9jKqvj/%2bsNT8VKrjIl0cccQQXOgLAZ%2bQchgMPPFBK0Er%2bHlQ2Uis%2btFK%2b0hyTF%2bTeEocttthi07KBETDrrruuIMgEfjE5mlWwSAnEbvlK%2bMEgQeKpZ%2bdZexRVglZriKw1q92bsF/uukjL2IT0vG4kFOJaodhss82ICUN79eqFTuLAhfF9ah5PgucVgQLACeqze%2bONN8Z%2bYJyvs846q6%2b%2bumjQBlqE7lhO8SoAjhyPORJD5asogrBoWHPlnC6hE4XNMhcGvjen0ETFpgmYywk540iK4Wk5AjDFdQxWjZqPTM8CIj6HHnqo%2bLjLxDXXXBPancuG/c5dd%2bQFEVhttdU23HBDIL0o7yWxZDUuTyvpsIiYwmBaAMy0gKtFVT%2b3llFcWrRoUVb9fiplaQuzuEcE%2bFtSHnLIIYx2zjI0QGXOFmJJ7DEIMQd/BIFl7GPu2muv7bEk7lZbbcV6LwKwwQYbrLLKKkC6RUyFkY6xEu/Zzd8Sd3LZAEu5RW2Lv90MU%2bSp8IARBFIoAVQQ5ILpAPQoG3LDQB8xikCZ8DGY1HrgoIMOojmeYTTCYA7lcWQ91mUS0CCRDyuttBJHeJK44aoJRFUnlfXGI/QD9RGJOvupVHGlAEsJ3mwtHwkSAQkgcBL0zDPPlJcASDX2mYkxiq2C7ugu/cFXBIDTRVkOWLey4VvCRYVYSZdkMyIFgzisVjacFDG5RP7pjCpaLYT3sgISSgqS/vGZ1BamCencsKXVUD4EiadNJYjBnfwqX7OoRcTLy5bFDZ%2bRZzAGlA1CMeldtj5LGwxyYK%2b99hIHjncMDGmw6qqrOkoDFQor1e31XRx0%2bK5siI0X8%2bbNK3Cr9TKyYRfWFcmAc7KTX/mekrCe8DOUKpt63XV0TiVE2TmxYr3nhYU1kBMl4QoDJYZo4FKEKDktDQCgB0LkLbnEvGoR22aVWVCbapZtWDfWd/xUqTIYAEaHPPwqoVmMjoqF2267TQREyfqDWjvhv/5lY7QnJY8jgQcGACImN%2bQuwkhrMgoDMCjkJzAAUzzpZIZFYHZWyh7dJ5KORetd/3rhUC3ByJnpSWJhRTIVv%2bEx3aZyFgopjqDmf5Mo%2bnqe6Z7Mst0M6AGTg5/7lg0AvN9oo41whteBYbepwLmL8hhmPZsNqL4aDAvMUVxpoezcJK2uLtrcas4qJ9vL2WGX%2bMaWA%2bZ5GioOXOuni9JgUK1JiSzWTAg4k0oJPJAcyYCLe5VNEGjoeuutx%2buYw2iMwqIAkGlZbVuOKsBUnMgpIGRUUeQihdVh0TCFZa%2bTv6kTMsyZM8dKVK5IebYaXu5SFdY7CgJCYwW6x3QnsPEcIac5vCgCHnBXQETMA4CpogFAdJwBgPURUESSD644kmnIZYJ4CgLr2SPTSByRIDySGLvamAdwi3gpoTxn/st8jtCcwSUsM9XLgYhdv7JxqgS4tmwozkSBIqAegwdID5xfNpGBiukpkPg7ymMKW3nllf0kSjlKce9iLD1gyfz581msomlQ/KLZuhEML4iDCVzJgeusN3wqUO43sDFYn222ADC5CCu3ScFgE6UoqcfA0Impmvx37doVhcy7CMN0AMCQvnyPP7yjXqK8MIgeb9a/g9W3r4t2vgEm2bHIjI0eERA1GcdzHgBKIGCwXFiCwTLS0ZPBoLFAQGi/JyFxC7WYbl4zE7MYc2J9WCQrADBDS3EBFC5xM3PxZrZ/6qrTAqDa5Wy9fZK6GgBTukxlDVNwV3qRPABYAI8xXDGYu5m8GM1iwNwyYyjxo7y4JAf8NE%2bhOFtTQgPguOKKKzqyXtWkVs%2bSFWxht0DLbFt9sKkkvmVRny9frWffREr1R0CEnmUyWNcsQOL1119fASMU6IQevMvu0EbolXGo4hZDs1r37lllQx46xr4NysZoKkQ9BWGdssGgWw8EudjSX6lYL/urOBT1WawhAqmraa330ZeDeRFtAoD1mGokMWFcvJs8MWR2XFBfHHqVDc3cAi/bQaLHBZJVAgSDOMgHpDIhCBHwWSKLPPVTt8XR9SqBeUWz7be433JZCWUaYh%2bbUIICiiwAkHAVLqnJBJrpHqNUAQBwEgAGpntAQFzMvpAk9i7reWGFFVZA/ZRx4hAAmBnugREhll35hFd9%2bWOeQqNoZ//HuXWnN80AkUIADI8wAKjAuJByg8Q42k/puYp4Mx3fAGau4ZPBWCSzhZFxZlzmylTzQABkAnY0CZie8eeIsmWJzCkmR1NB6rnsA8kKC4Oi2R56qmjTdRbmqckwgSmMCwAMNp5cxCL8oT/5fJTtXq8wncVYJCUys4JngcbNNIcc6QGF/MQi7M%2bKjFOA7Fm2yIOhdavEyh8AUgVZ5SxbUra5g2sOthpiE24wSASOKRty4zEvGszAWQqSRYKdh1N0eCUVBxjHlU0uCZGcXm655fCHO8SQC9YtWwCICY/ov2/ZvCUIMgcAk4yli0KB9VYIrFdWNI2Ah6I/qcAwBADsZyiDeBEBMDh7IZlKWcY%2bgpsveSo//hYuRMr0l007di%2b//PJZPYuAmYsjHJMDznWIqIaTS/iT0j37vhihKKLsTLfwUGUUzVZhKlgMkwBsYj1rxJH1XMK1IktPYchaXtqxCRlwl8s9z2FZfMZ65kpl5ZdqDCXwx3VXOD6FA0GLCoHhp2cGlg1Ig4a3mGkpbLExadIk9SkAxiqyF1Rf1CfB586d6%2bl8ltNQgj9EICU%2bbggCITIwC9iXQoBBUBky0zNny2/C7wGvq7SVYgJFgrK5hDZYhI1UNQsajpDE%2bucyFhsrUwoxyP6fujifPXnWfFIsWLBApZF9h3qlIeWFGxMCQHc6ZRBe0iIBzbcWEtSpU6eDyuYcAUTDubu86HmYDYMSTJkwYYIVLA0VKB06AiwH9COe3EGOzMd64G9UzMZMRAyXMtVk05JnKayhi3yuq39%2bzASh4PYo2nGV1xzjjPgDenh4WhdCYQxQuZBHqZMUzLYpDNwMgCsCQhKUVYp%2bd%2bWlOYTL%2bVuIACA%2bqAWSc8zRIVUQN2TTTypfNAYsm5ZQeaVo8wOeOtuiQQHnadaLnWgKItA8aniFpytcQkAZJOHwjbfCB4QJAKMiTD7syQQD6zA7uMADwP3MTfS8C78O4QEAaQEwtG4BYK6L8AgLw9xiQMeOHYuGf/tEQK0HaFZmAM%2bxz5GbszvCJaNGjUrhAFX2PZ1I3Ow/%2bwkn/ghX97LRdapveKjM3O6Km4KZAHjdXXGA3DOo4sXs1iT%2bqQBS9p5WtsFl44uWHMg/ZbKtUvFH/UN/AoChBs42rQEUZ8awiteRGddCR2K5SD2kJq5zZz6kAiMObBUHTuV4P2EDgLTrzZN4z%2bUqZ8zp0KED1zCdj7zLbu43bsowDEwaJL%2bza49RLeW0HKj%2bA5XPBePHj7%2b6bLieaRUSwzMiomZySKGmUiJngkOC5B9KCCvHZNXG9GoB5HUnKYQcGeouPFRL2uQDhxf5Aie5QP/ZlUkZFvFwRX6zB4elqGPR8Lep1BijR4/ON3dYuT8fg3Wd%2bpYdWBhlmDhxosmFTJFwVY0jazwpd7Pr6PlQIv/ugITLo7MIhkhygBLkw4cIQ%2b5dPWdpEdXO0swrPOUiSMI%2bcuRIGIr6R4BgsHZG8XxWYZkw4bpeBNp4encFhfiPfdxP2qGlgACYSs0M/Jdi2AOeD4OZixL8ynp40C%2brCN2y2y3u95ZQDxs2rNqdzyLJ0Ys5ps6VG6y30Cka6h90IqBJADnE/VEhfKDWxmBWqvPseCKbhBk7dixBRKHsUaea11gPM6hsTT4ADw%2bPRtZYmU1S1tAAljly39ChQyNZHOfdbE5KA%2b9mB5ZhWNBSSlTbjhFQi3/GBUBmX0fv5I8ZXKWXESNGeFMKss9qk4BiESakMEZlt9gNredlc/bYWBwXogFCZ8%2bLGrKeAMDGbkbzjghU39f8NCL34U/%2b4JKVnTgIgqFbkliBWi2WZ82axTjaUs0A4Q/Hy2BO9bKy1kiM0xcAnDd16lTpwXo5kAh0KZuVlyE9zFvieUnZskdkeEj4W8/mb51jdj4wG33MmDHMwBAY2ICBHMH9qU08mcWdh4v8ZTgCmj8aqyCMZyQAsor1KPu4iif0rqQRRPzmVwOAJ%2bk9QAphUAiwO9voqSkoQfbyp0yZMnPmzGnTpqkpUpik2vGuseBhq%2bBn3zz/URBtrmRAqpL8xyUbOS56vqjzJ39gAotKcljEB9xoNpuyT8bc7MmZ7fULFZDyAXnMprjEdJNUQhT14GkGzZgxQ9GlDtN/1MwD/Op1vjAig5wzGgAVWwAgMzMYnSLAi1mdMgCGoj4NW/mLGgDeyTYg/gSAydKbriuJeZTR7rouLMw1T/Ff1BD1oc2%2bYtZx%2bUrAeZRt9uzZopHFnU5orp4FgYkpchzBEwS1DE8xBtnkIUfwfURWxLySrYOi0p%2bFCxfSRAxJqQRA/sxkeK7iYKPmy7sTb7Iyy6h8ZhQT/XpMv0lTo8YFUUOu5VHGZYtOD6YL6y%2bwsydgUHcTfzRmfXKABkTK84mW%2b6Ns%2bSy0bFvFmt8A0oiop4pOHZG5nU3CahmalDJZko7s4XQuW5TeMTO8FNIJm6SssRmUP54JCy%2b6AqdpWA1XWWNoueeYP75kNxsYt%2biPPqNC%2beyZPwy2RCDsd5w%2bfTrlEgGvMT3/3WNuBCt/yOJIswF/KxksQSztsyWRz8MGMJjn%2bTgelZE0ygKK0Fl15LNxqjQAaFp2CWi8IfKlh9cZDQMicAFHiED0R/9OqGoWhs5h%2bC8yJbY1bMqe%2bgAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="353" data-src="/assets/static/profile-picture-avatar.f2e32bb.8d4b8fabe4713bb68e0d2364854763d6.png" data-srcset="/assets/static/profile-picture-avatar.f2e32bb.8d4b8fabe4713bb68e0d2364854763d6.png 353w" data-sizes="(max-width: 353px) 100vw, 353px" class="is-rounded g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/profile-picture-avatar.f2e32bb.8d4b8fabe4713bb68e0d2364854763d6.png" class="is-rounded g-image g-image--loaded" width="353" alt="Julia Glaszka"></noscript></figure><p class="title is-4 is-bold pt-5">
      Julia Glaszka
    </p><p class="subtitle is-7">
      julia.anna.glaszka@interia.pl
    </p></div><div class="content"><p> Pasjonuję się IT, ekonomią i muzyką. 
    Moim ulubionym językiem jest Java i w niej pracuję na codzień. </p></div></div></div><hr><div class="block has-text-centered"><p class="title is-4"> Tagi </p><div class="tags is-justify-content-center"><a href="/tag/mongodb/" class="tag is-rounded">
    #Mongodb
  </a><a href="/tag/java/" class="tag is-rounded">
    #Java
  </a><a href="/tag/database/" class="tag is-rounded">
    #Database
  </a></div></div><hr><div class="block"><p class="title is-4 has-text-centered"> Najnowsze posty</p><div class="column"><div class="card" style="height: 100%"><div class="card-image p-0"><a href="/obiektywizm-a-rozwoj-w-it/"><img alt="Post cover photo" src="/images/posts/obiektywizm/atlas.jpg" class="g-image"></a></div><div class="card-content"><h5 class="title is-size-5 has-padding-bottom-10"><a href="/obiektywizm-a-rozwoj-w-it/">Obiektywizm a rozwój w IT</a></h5><!----><!----></div><!----><footer class="card-footer"><a href="/obiektywizm-a-rozwoj-w-it/" class="card-footer-item">Przeczytaj</a></footer></div></div><div class="column"><div class="card" style="height: 100%"><div class="card-image p-0"><a href="/wykorzystaj-caly-potencjal-klastra-mongo-db-z-pomoca-preferencji-odczytu/" aria-current="page" class="active--exact active"><img alt="Post cover photo" src="/images/posts/mongodb-read-preferences/route.jpg" class="g-image"></a></div><div class="card-content"><h5 class="title is-size-5 has-padding-bottom-10"><a href="/wykorzystaj-caly-potencjal-klastra-mongo-db-z-pomoca-preferencji-odczytu/" aria-current="page" class="active--exact active">Wykorzystaj cały potencjał klastra MongoDB z pomocą preferencji odczytu</a></h5><!----><!----></div><!----><footer class="card-footer"><a href="/wykorzystaj-caly-potencjal-klastra-mongo-db-z-pomoca-preferencji-odczytu/" aria-current="page" class="card-footer-item active--exact active">Przeczytaj</a></footer></div></div><div class="column"><div class="card" style="height: 100%"><div class="card-image p-0"><a href="/konfiguracja-cluster-settings-w-mongo-db-java-driver/"><img alt="Post cover photo" src="/images/posts/cluster-settings-mongo/adjusting.jpg" class="g-image"></a></div><div class="card-content"><h5 class="title is-size-5 has-padding-bottom-10"><a href="/konfiguracja-cluster-settings-w-mongo-db-java-driver/">Konfiguracja ClusterSettings w MongoDB Java Driver</a></h5><!----><!----></div><!----><footer class="card-footer"><a href="/konfiguracja-cluster-settings-w-mongo-db-java-driver/" class="card-footer-item">Przeczytaj</a></footer></div></div></div></section></div></div></section><div></div></div><footer id="contact" class="footer has-background-black p-t-xl"><div class="container"><div class="columns"><div class="column has-text-left"><a href="#" class="title is-4 has-text-grey section-title">Blog Julii Glaszka</a><p class="pt-5">
          Założyłam tego bloga, aby móc spisywać swoje przemyślenia, nabytą wiedzę i pomysły. 
          Moim celem jest tworzenie przydatnej treści, a nie powielanie klikalnych buzzwordów. 
          Chciałabym też pokazywać, że nie trzeba mieć ukończonych studiów ani płacić za kursy, aby być dobrym inżynierem IT.
        </p><h5 class="title is-5 pt-5 has-text-grey">#cytaty</h5><p class="is-family-monospace">
          Either life entails courage, or it ceases to be life.
          ~ E. M. Forster
        </p><p class="pt-5 is-family-monospace"><i>
            Wynalazca to człowiek, który pyta wszechświat: &quot;Dlaczego?&quot; 
            i nie pozwala,
            by cokolwiek stanęło między odpowiedzią 
            a jego umysłem. ~ &quot;Atlas Shrugged&quot;, Ayn Rand
          </i></p><p class="pt-5">
          e-mail: julia.anna.glaszka@interia.pl
        </p></div><div class="column is-half has-text-left"><div class="title is-4 section-title has-text-grey">Kontakt</div><div class="tile is-ancestor"><div class="tile is-4 is-vertical is-parent"><div class="tile is-child box"><a href="'https://github.com/julia-glaszka'">GITHUB #1</a></div><div class="tile is-child box has-background-dark"><a href="'https://github.com/jglaszka'">GITHUB #2</a></div></div><div class="tile is-parent"><div background="/images/lemons.jpg" class="tile is-child box has-background-dark"><a href="'https://dev.to/evilghostgirl'">DEV.TO</a></div></div><div class="tile is-parent"><div background="/images/lemons.jpg" class="tile is-child box has-background-dark"><a href="'https://dev.to/evilghostgirl'">LINKEDIN</a></div></div></div><div class="tile is-ancestor"><div class="tile is-6 is-vertical is-parent"><div class="tile is-child box has-background-dark"><a href="'https://www.duolingo.com/profile/evilghostgirl'">DUOLINGO</a></div></div><div class="tile is-6 is-vertical is-parent"><div class="tile is-child box has-background-dark"><a href="mailto:julia.anna.glaszka@interia.pl"> EMAIL</a></div></div></div></div></div><div class="columns"><div class="column has-text-centered has-text-right-tablet"><p class="subtitle is-5"><span class="copyleft">©</span> juliagl</p></div></div></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Wykorzystaj cały potencjał klastra MongoDB z pomocą preferencji odczytu","path":"\u002Fwykorzystaj-caly-potencjal-klastra-mongo-db-z-pomoca-preferencji-odczytu\u002F","slug":"mongodb-read-preferences","datetime":"2021-11-15 18:37:24","content":"\u003Ch1 id=\"\"\u003E\u003C\u002Fh1\u003E\n\u003Cp\u003ETypowy produkcyjny klaster jest zbudowany z co najmniej jednego ReplicaSetu. To oznacza, że posiadamy co najmniej jeden węzeł Primary (realizujący zapisy i odczyty) i kilka Secondary (tylko do odczytu). Domyślne ustawienia konfiguracji sterowników kierują ruch wyłącznie do Primary, rezygnując z używania pozostałych hostów. To oznacza, że obciążony jest tylko jeden node, a reszta pozostaje bierna - zasoby pod względem load-balancingu są marnowane. W przypadku awarii Mastera tracimy też możliwość odczytów, które mogłyby być nadal realizowane przez Secondary.\u003C\u002Fp\u003E\n\u003Cp\u003EZatem w jaki sposób można wymusić kierowanie ruchu do innych hostów niż Primary? Z pomocą przychodzą nam preferencje odczytu - tzw. \u003Ccode\u003EReadPreference\u003C\u002Fcode\u003E. Posiada on różne tryby, pozwalające na wybranie algorytmu poszukiwania hosta, do którego wyślemy query.\u003C\u002Fp\u003E\n\u003Ch2 id=\"konfiguracja-preferencji-odczytu-w-driverze\"\u003EKonfiguracja preferencji odczytu w driverze\u003C\u002Fh2\u003E\n\u003Cp\u003EUstawienia \u003Ccode\u003EReadPreference\u003C\u002Fcode\u003E można zdefiniować w kilku miejscach:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Ena poziomie klastra:\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #2e3440\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClient\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E mongoClient \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E=\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClients\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ecreate\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoClientSettings\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ebuilder\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E()\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E  \u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ehosts\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003ElistOfHostsUrls\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EreadPreference\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EReadPreference\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Esecondary\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E  \u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Ebuild\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003Ena poziomie bazy danych\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #2e3440\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoDatabase\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E database \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E=\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E mongoClient\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EgetDatabase\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003EsomeDatabase\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E  \u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EwithReadPreference\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EReadPreference\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Esecondary\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003Ena poziomie kolekcji\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #2e3440\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EMongoCollection&lt;Document&gt;\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E collection \u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E=\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E database\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EgetCollection\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A3BE8C\"\u003Evideos\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #D8DEE9FF\"\u003E  \u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #D8DEE9FF\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003EwithReadPreference\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #8FBCBB\"\u003EReadPreference\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E.\u003C\u002Fspan\u003E\u003Cspan style=\"color: #88C0D0\"\u003Esecondary\u003C\u002Fspan\u003E\u003Cspan style=\"color: #ECEFF4\"\u003E())\u003C\u002Fspan\u003E\u003Cspan style=\"color: #81A1C1\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EPodane ustawienia mogą zmieniać działanie usługi, jeśli na przykład posiada na klastrze kilka różnych baz danych z różnymi kolekcjami. Może być tak, że nie dla wszystkich kolekcji można sobie pozwolić na odczyt z Secondary - np. gdy potrzebujemy wyższy poziom consistency.\u003C\u002Fp\u003E\n\u003Ch2 id=\"tryby-odczytu\"\u003ETryby odczytu\u003C\u002Fh2\u003E\n\u003Ch3 id=\"primary\"\u003Eprimary\u003C\u002Fh3\u003E\n\u003Cp\u003EDomyślny dla wielu driverów. Kieruje ruch wyłącznie do hosta typu Primary, co może być znaczącą barierą w skalowaniu usługi pod kątem odczytów.\u003C\u002Fp\u003E\n\u003Ch3 id=\"primarypreferred\"\u003EprimaryPreferred\u003C\u002Fh3\u003E\n\u003Cp\u003EW tej preferencji w głównej mierze odczytujemy z hosta Primary, ale w przypadku gdy będzie niedostępny to odczyty zostaną przekierowana do innych replik typu Secondary.\u003C\u002Fp\u003E\n\u003Ch3 id=\"secondary\"\u003Esecondary\u003C\u002Fh3\u003E\n\u003Cp\u003EWszystkie odczyty są kierowane do Secondary.\u003C\u002Fp\u003E\n\u003Ch3 id=\"secondarypreferred\"\u003EsecondaryPreferred\u003C\u002Fh3\u003E\n\u003Cp\u003EW większości przypadków odczytujemy z Secondary, ale przy awarii wszystkich hostów ruch może zostać przekierowany do Primary.\u003C\u002Fp\u003E\n\u003Ch3 id=\"nearest\"\u003Enearest\u003C\u002Fh3\u003E\n\u003Cp\u003EDriver selekcjonuje zdrowe hosty z odpowiednio krótkim czasem odpowiedzi, tak by odpowiedziały maksymalnie szybko - np w ramach jednego datacenter. Następnie losowo wybierany jest jeden host, który zrealizuje żądanie. Nie jest uwzględniane czy node jest Primary czy Secondary.\u003C\u002Fp\u003E\n\u003Ch2 id=\"jaki-tryb-odczytu-wybrać\"\u003EJaki tryb odczytu wybrać?\u003C\u002Fh2\u003E\n\u003Cp\u003EW przypadku usługi typu heavy read z eventual consistency najbardziej optymalne będzie odczytywanie z preferencjami: \u003Ccode\u003Enearest\u003C\u002Fcode\u003E, \u003Ccode\u003EsecondaryPreferred\u003C\u002Fcode\u003E lub \u003Ccode\u003Esecondary\u003C\u002Fcode\u003E. Wybór konkretnej preferencji zależałby w tym przypadku od ilości zapisów oraz posiadanych hostów i zasobów. Jeśli usługa bardzo dużo zapisuje i Primary jest już dostatecznie obciążony, można rozważyć unikanie dociążania Primary poprzez preferencję \u003Ccode\u003Esecondary\u003C\u002Fcode\u003E lub \u003Ccode\u003EsecondaryPreferred\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EOstateczny wybór między pozostałymi dwoma typami odczytów może rozstrzygnąć to - czy bardziej zależy nam na stabilności odczytów czy zapisów. SecondaryPreferred dostarcza n+1 hostów, natomiast samo secondary tylko n (bo nie uwzględnia Primary).\u003C\u002Fp\u003E\n\u003Cp\u003EW sytuacji niespodziewanie większego ruchu warto mieć więcej dostępnych hostów niż mniej, ale analizując z drugiej strony - ten jeden dodatkowy host to Primary, jeśli zostanie obciążony to doprowadzi to również do niestabilności zapisów. Jeśli usługa nie posiada mechanizmów ponowień takich jak klienci z ponowieniami lub message queue, to dane mogą zostać niezapisane, co skłaniałoby do użycia preferencji secondary - wtedy awaria dotyczyłaby tylko odczytów.\u003C\u002Fp\u003E\n\u003Ch2 id=\"po-wdrożeniu\"\u003EPo wdrożeniu\u003C\u002Fh2\u003E\n\u003Cp\u003EPo wdrożeniu nowego typu preferencji warto mieć wgląd w metryki:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Eczasów odpowiedzi usługi\u003C\u002Fli\u003E\n\u003Cli\u003Eczasów odpowiedzi bazy danych do usługi\u003C\u002Fli\u003E\n\u003Cli\u003Eload, zajętość ramu, ilość rps do kolekcji, obciążenie sieciowe klastra mongo\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"podsumowanie\"\u003EPodsumowanie\u003C\u002Fh2\u003E\n\u003Cp\u003EJak widać, każde takie ustawienie trzeba samodzielnie przeanalizować, uwzględniając swoje własne wymagania względem stabilności. Wybranie konkretnej preferencji odczytu może mieć dalekosiężne skutki, dlatego przed wyborem zawsze warto się dłużej zastanowić i przeanalizować słabe punkty konkretnego rozwiązania. Polecam również zapoznać się z \u003Ca href=\"https:\u002F\u002Fdocs.mongodb.com\u002Fmanual\u002Fcore\u002Fread-preference\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eoficjalną dokumentacją\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n","description":"MongoDB dostarcza wiele mechanizmów sterowania consistency. Jak uzyskać większą przepustowość odczytu kosztem spójności danych? O tym w dzisiejszym poście!","timeToRead":3,"cover":"\u002Fimages\u002Fposts\u002Fmongodb-read-preferences\u002Froute.jpg","author":{"id":"Julia Glaszka","title":"Julia Glaszka"},"tags":[{"id":"mongodb","title":"mongodb","path":"\u002Ftag\u002Fmongodb\u002F"},{"id":"java","title":"java","path":"\u002Ftag\u002Fjava\u002F"},{"id":"database","title":"database","path":"\u002Ftag\u002Fdatabase\u002F"}]},"recommendedposts":{"edges":[{"node":{"id":"5c6912511fbf00580160f309c8bff279","title":"Obiektywizm a rozwój w IT","path":"\u002Fobiektywizm-a-rozwoj-w-it\u002F","cover":"\u002Fimages\u002Fposts\u002Fobiektywizm\u002Fatlas.jpg"}},{"node":{"id":"507900b37c02db543d8fa26f4705fb1e","title":"Wykorzystaj cały potencjał klastra MongoDB z pomocą preferencji odczytu","path":"\u002Fwykorzystaj-caly-potencjal-klastra-mongo-db-z-pomoca-preferencji-odczytu\u002F","cover":"\u002Fimages\u002Fposts\u002Fmongodb-read-preferences\u002Froute.jpg"}},{"node":{"id":"c854d4a554f3e6aa74a421fac8beb243","title":"Konfiguracja ClusterSettings w MongoDB Java Driver","path":"\u002Fkonfiguracja-cluster-settings-w-mongo-db-java-driver\u002F","cover":"\u002Fimages\u002Fposts\u002Fcluster-settings-mongo\u002Fadjusting.jpg"}}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.b3cdbf32.js" defer></script><script src="/assets/js/page--src--templates--post-vue.c6413ee8.js" defer></script>
  </body>
</html>
